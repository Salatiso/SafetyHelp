<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SafetyHelp | OHS System Management</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* Base styles from subpage_Final.html - Retained for consistency */
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #E8F0FE;
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
    }
    header {
      background: #007BFF;
      color: #fff;
      padding: 0.8rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 1001;
    }
    .logo-container { display: flex; align-items: center; color: #fff; text-decoration: none;}
    .logo { font-weight: 700; font-size: 1.75rem; letter-spacing: -0.025em; }
    .logo .help { font-weight: 900; color: #FF8C00; }
    nav { display: flex; gap: 0.5rem; }
    nav a {
      color: white;
      font-weight: 500;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      transition: background-color 0.3s ease, transform 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border: 1px solid transparent;
      text-decoration: none;
    }
    nav a:hover, nav a.active-nav-link {
      background-color: rgba(255,255,255,0.15);
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.3);
    }
    nav a .nav-icon { font-size: 0.9em; }
    .search-language { display: flex; align-items: center; gap: 1rem; }
    .search-language input, .search-language select {
      padding: 0.6rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Montserrat', sans-serif;
      background-color: #fff;
      color: #333;
      font-size: 0.9rem;
    }

    .page-title-section {
      background: #F3F4F6;
      padding: 1.5rem 2rem;
      text-align: center;
      border-bottom: 1px solid #e0e0e0;
      flex-shrink: 0;
    }
    .page-title-section h1 { font-size: 2.2rem; color: #1f2937; margin-bottom: 0.5rem; }
    .page-title-section p.subtitle { font-size: 1rem; color: #374151; max-width: 800px; margin-left: auto; margin-right: auto; }

    .page-content-container {
      display: flex;
      flex-grow: 1;
      overflow: hidden;
    }
    .container-grid {
      display: grid;
      grid-template-columns: 1fr 3fr 1fr;
      flex-grow: 1;
      overflow: hidden;
      min-height: 0;
      gap: 1rem;
      padding: 1rem;
      max-height: calc(100vh - 150px); /* Adjust based on actual header/footer/title height */
    }

    .sidebar-tools, .sidebar-milestones {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .sidebar-heading {
      font-size: 1.2rem;
      font-weight: 700;
      color: #007BFF;
      padding: 1rem;
      border-bottom: 1px solid #e5e7eb;
      background-color: #f9f9f9;
      flex-shrink: 0;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .sidebar-heading .heading-icon { color: #FF8C00; }
    
    .sidebar-tools .sidebar-list-container {
        flex-grow: 1;
        overflow-y: auto;
        padding: 0.5rem;
    }
    .sidebar-tools ul { list-style: none; padding: 0; margin: 0; }
    .sidebar-tools li { margin-bottom: 0.5rem; }
    .sidebar-tools li a {
      display: flex; 
      align-items: center; 
      padding: 0.75rem 1rem; 
      border-radius: 6px; 
      background-color: #f0f8ff; 
      color: #0056b3; 
      font-weight: 500;
      text-decoration: none;
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05); 
      gap: 0.75rem; 
    }
    .sidebar-tools li a:hover {
        background-color: #e0effe; 
        transform: translateY(-2px); 
        box-shadow: 0 3px 6px rgba(0,0,0,0.08);
    }
    .sidebar-tools li a.active-tool-link {
        background-color: #FF8C00; 
        color: white;
        font-weight: 700;
        box-shadow: 0 2px 5px rgba(255,140,0,0.3); 
    }
    .sidebar-tools li a.active-tool-link .list-icon { color: white; }
    .sidebar-tools li a .list-icon {
        color: #007BFF; 
        font-size: 1em; 
        width: 20px;
        text-align: center;
        flex-shrink: 0; 
    }

    .sidebar-milestones .sidebar-list-container {
        flex-grow: 1;
        overflow: hidden; 
        position: relative;
    }
    .sidebar-milestones ul { list-style: none; padding: 0; margin: 0; }
    .sidebar-milestones:hover ul { animation-play-state: paused !important; }
     @keyframes continuousScrollUp {
        0% { transform: translateY(0%); }
        100% { transform: translateY(-50%); } 
    }
    .sidebar-milestones li { 
      padding: 0; 
      border-bottom: 1px solid #e5e7eb; 
      cursor: pointer; 
      display: flex; 
      align-items: center;
      gap: 0.75rem;
      font-size: 0.9rem;
      padding: 0.85rem 1rem; 
      width: 100%; 
      transition: background-color 0.3s ease;
      color: #333; 
      background-color: #fff; 
    }
    .sidebar-milestones li:hover { background: #e8f0fe; }
    .sidebar-milestones li .list-icon {
        color: #007BFF;
        font-size: 1em;
        width: 20px; 
        text-align: center;
        flex-shrink: 0;
    }

    .main-subpage-content {
      padding: 1.5rem;
      overflow-y: auto; 
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .main-subpage-content section { margin-bottom: 2.5rem; }
    .main-subpage-content h2 {
        font-size: 1.8rem;
        color: #0056b3; 
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #FF8C00; 
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    .main-subpage-content h2 .section-icon { color: #FF8C00; }
    .main-subpage-content p, .main-subpage-content li { font-size: 1rem; line-height: 1.7; color: #374151; margin-bottom: 1rem; }
    .main-subpage-content ul { list-style: disc; padding-left: 20px; }
    .main-subpage-content details summary {
      cursor: pointer;
      font-weight: 600;
      padding: 0.75rem;
      background-color: #f0f8ff; /* Light blue for summaries */
      border: 1px solid #d1e7fd;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.2s ease;
    }
    .main-subpage-content details summary:hover {
        background-color: #e0effe;
    }
    .main-subpage-content details summary::after {
      content: '\\f078'; 
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      transition: transform 0.2s ease-in-out;
      color: #007BFF;
    }
    .main-subpage-content details[open] summary::after {
      transform: rotate(180deg);
    }
    .main-subpage-content details > div { /* Content of details */
      padding: 1rem;
      border: 1px solid #e0e0e0;
      border-top: none;
      border-radius: 0 0 6px 6px;
      background-color: #fdfdff; /* Slightly off-white for content */
    }
    .main-subpage-content details div a { color: #007BFF; text-decoration: underline; }
    .main-subpage-content details div a:hover { color: #0056b3; }

    .action-button {
        padding: 0.75rem 1.5rem;
        border-radius: 6px;
        font-weight: 500;
        transition: background-color 0.3s ease, transform 0.2s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        text-align: center;
        cursor: pointer;
        border: none; 
        text-decoration: none; 
    }
    .action-button-primary { background-color: #007BFF; color: white; }
    .action-button-primary:hover { background-color: #0056b3; transform: translateY(-2px); }
    .action-button-secondary { background-color: #FF8C00; color: white; }
    .action-button-secondary:hover { background-color: #e07b00; transform: translateY(-2px); }
    .action-button-tertiary { background-color: #6c757d; color: white; } /* For less prominent actions */
    .action-button-tertiary:hover { background-color: #5a6268; transform: translateY(-2px); }
    
    .interaction-buttons-container {
      display: flex;
      flex-direction: column; 
      gap: 1rem; 
      margin-top: 1rem; 
      margin-bottom: 1.5rem; /* Added margin for spacing */
    }
    .interaction-buttons-container .action-button { flex: 1; }

    @media (min-width: 768px) { /* Using 768px for sm/md breakpoint consistency */
      .interaction-buttons-container {
        flex-direction: row;
      }
    }

    .nav-buttons { margin-top: 1.5rem; display: flex; justify-content: space-between; gap: 1rem; }
    
    .wizard-step { border: 1px solid #e0e0e0; border-radius: 8px; padding: 1.5rem; margin-top: 1.5rem; background-color: #f9fafb; }
    .wizard-step h3, .wizard-step h4 { font-size: 1.5rem; color: #111827; margin-bottom: 1rem; }
    .wizard-step h4 { font-size: 1.25rem; color: #0056b3; margin-top: 1.5rem;}

    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; font-weight: 600; margin-bottom: 0.35rem; color: #374151; font-size: 0.95rem; }
    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group input[type="tel"],
    .form-group input[type="number"],
    .form-group input[type="date"],
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.6rem 0.8rem;
      border: 1px solid #D1D5DB;
      border-radius: 6px;
      font-family: 'Montserrat', sans-serif;
      font-size: 0.95rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      box-sizing: border-box; 
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      border-color: #007BFF;
      box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
      outline: none;
    }
    .form-group .checkbox-group label, .form-group .radio-group label { display: inline-flex; align-items: center; margin-right: 1rem; font-weight: normal; cursor:pointer;}
    .form-group .checkbox-group input, .form-group .radio-group input { margin-right: 0.5rem; }
    .form-group .description { font-size: 0.85rem; color: #555; margin-top: 0.25rem; }
    
    /* Manual Selection Document Categories */
    .document-category-list { margin-top: 1rem; }
    .document-category-list details summary { font-size: 1.2rem; background-color: #e8f0fe; }
    .document-category-list details summary:hover { background-color: #d4e2f7; }
    .document-category-list details > div { background-color: #fff; }
    .document-item { display: flex; align-items: flex-start; padding: 0.75rem 0.5rem; border-bottom: 1px solid #eee; }
    .document-item:last-child { border-bottom: none; }
    .document-item input[type="checkbox"] { margin-top: 0.25rem; margin-right: 0.75rem; flex-shrink: 0; }
    .document-item-info { flex-grow: 1; }
    .document-item-info strong { display: block; font-size: 1rem; color: #0056b3; margin-bottom: 0.25rem; }
    .document-item-info p { font-size: 0.85rem; color: #555; margin-bottom: 0; line-height: 1.4; }
    .document-item-info .fas { margin-right: 0.3rem; color: #FF8C00; }

    /* Accordion Styles for module-specific resources */
    .accordion-container { }
    .accordion-item { margin-bottom: 1rem; }
    .accordion-button {
        background-color: #007BFF; 
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 700;
        font-size: 1.1rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border: none;
        width: 100%;
        text-align: left;
        transition: background-color 0.2s ease;
    }
    .accordion-button:hover { background-color: #0056b3; }
    .accordion-button .fas.fa-chevron-down, .accordion-button .fas.fa-chevron-up { 
        transition: transform 0.3s ease;
        color: #FF8C00; 
    }
    .accordion-button.expanded .fas.fa-chevron-down, .accordion-button.expanded .fas.fa-chevron-up {
        transform: rotate(180deg);
    }
    .accordion-content {
        display: none;
        margin-top: 0; 
        padding: 1.5rem;
        background-color: #f9f9f9; 
        border-radius: 0 0 0.5rem 0.5rem; 
        border: 1px solid #e0e0e0;
        border-top: none; 
        animation: fadeIn 0.5s ease-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .resource-item { 
        padding: 1rem;
        margin-bottom: 1rem;
        background-color: #ffffff;
        border: 1px solid #e0e0e0;
        border-radius: 0.5rem;
    }
    .resource-item:last-child { margin-bottom: 0; }
    .resource-item h4 {
        font-size: 1.1rem;
        font-weight: 600;
        color: #0056b3; 
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
    }
    .resource-item h4 .fas { margin-right: 0.75rem; color: #FF8C00; }
    .resource-item p { font-size: 0.95rem; color: #374151; margin-bottom: 0.5rem; line-height: 1.6; }
    .resource-item .links a { margin-right: 1rem; font-size: 0.9rem; color: #007BFF; text-decoration: underline; cursor: pointer; }
    .resource-item .links a:hover { color: #0056b3; }
    .resource-item .links a i { margin-right: 0.3rem; }

    /* Review Step Styling */
    .review-section { margin-bottom: 1.5rem; }
    .review-section h4 { font-size: 1.2rem; color: #0056b3; margin-bottom: 0.5rem; border-bottom: 1px solid #eee; padding-bottom: 0.25rem;}
    .review-section p { font-size: 1rem; margin-bottom: 0.3rem; }
    .review-section p strong { color: #333; }
    .review-section ul { list-style: disc; margin-left: 20px; }
    .review-section ul li { font-size: 0.95rem; margin-bottom: 0.25rem; }


    footer {
      background: #343a40; 
      color: #adb5bd;
      text-align: center;
      padding: 1.5rem 2rem;
      font-size: 0.9rem;
      flex-shrink: 0;
      border-top: 3px solid #FF8C00; 
    }
    footer p { margin-bottom: 0.5rem; }
    footer a { color: #FF8C00; transition: color 0.3s ease; text-decoration: none;}
    footer a:hover { color: #fff; }

    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); padding-top: 60px; }
    .modal-content { background-color: #fefefe; margin: 5% auto; padding: 25px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative; }
    .modal-header { padding-bottom: 10px; border-bottom: 1px solid #eee; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
    .modal-header h4 { margin: 0; font-size: 1.4rem; color: #007BFF; }
    .close-btn { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.3s; }
    .close-btn:hover, .close-btn:focus { color: #333; text-decoration: none; }
    .modal-body p { font-size: 1rem; line-height: 1.6; margin-bottom: 1rem; }
    .modal-footer { padding-top: 15px; border-top: 1px solid #eee; margin-top: 20px; text-align: right; }
    .modal-footer .action-button-secondary { background-color: #6c757d; }
    .modal-footer .action-button-secondary:hover { background-color: #5a6268; }

    .chatbot-container { position: fixed; bottom: 20px; right: 20px; z-index: 1050; }
    #chat-toggle { background-color: #FF8C00; color: white; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 1.8rem; box-shadow: 0 4px 8px rgba(0,0,0,0.2); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.3s ease, transform 0.3s ease; }
    #chat-toggle:hover { background-color: #e07b00; transform: scale(1.1); }
    #chat-window { width: 320px; max-height: 450px; background-color: #fff; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); display: flex; flex-direction: column; overflow: hidden; transition: opacity 0.3s ease, transform 0.3s ease; position: absolute; bottom: 75px; right: 0; opacity: 0; transform: translateY(10px); pointer-events: none; }
    #chat-window.chat-expanded { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .chat-hidden { display: none !important; } 
    #chat-header { background-color: #007BFF; color: white; padding: 10px 15px; font-weight: 600; border-top-left-radius: 10px; border-top-right-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
    #chat-header .close-chat-btn { background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; }
    #chat-output { flex-grow: 1; padding: 15px; overflow-y: auto; font-size: 0.9rem; background-color: #f9f9f9; }
    #chat-output p { margin-bottom: 0.8rem; line-height: 1.4; }
    #chat-output p strong { color: #007BFF; }
    #chat-output p strong:first-child { color: #FF8C00; }
    #chat-input-container { display: flex; border-top: 1px solid #eee; padding: 10px; background-color: #fff; }
    #chat-input { flex-grow: 1; padding: 0.7rem; border: 1px solid #ddd; border-radius: 6px; margin-right: 8px; font-family: 'Montserrat', sans-serif; }
    #chat-send { background-color: #007BFF; color: white; padding: 0.7rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; transition: background-color 0.3s ease; }
    #chat-send:hover { background-color: #0056b3; }

    .hidden { display: none; }
    .error-message { color: red; font-size: 0.8rem; margin-top: 0.25rem;}


    @media (max-width: 1024px) { 
      .container-grid { grid-template-columns: 1fr; }
      .sidebar-tools, .sidebar-milestones { max-height: 300px; margin-bottom: 1rem; }
       main.main-subpage-content { order: -1; }
    }
    @media (max-width: 768px) { 
        header { flex-direction: column; gap: 0.5rem; padding: 0.8rem 1rem; }
        nav { flex-wrap: wrap; justify-content: center; gap: 0.25rem; } 
        nav a { padding: 0.5rem 0.8rem; } 
        .search-language { width: 100%; justify-content: space-between; margin-top: 0.5rem;}
        .search-language input { flex-grow: 1; margin-right: 0.5rem; }
        .page-title-section h1 { font-size: 1.8rem; }
        .page-title-section p.subtitle { font-size: 0.9rem; }
        .main-subpage-content h2 { font-size: 1.6rem; }
        .wizard-step h3, .wizard-step h4 { font-size: 1.3rem; }
        .action-button { padding: 0.6rem 1.2rem; font-size: 0.9rem;}
    }

  </style>
</head>
<body>
  <header>
    <a href="/SafetyHelp/index.html" class="logo-container">
        <div class="logo">Safety<span class="help">Help</span></div>
    </a>
    <nav>
      <a href="/SafetyHelp/index.html"><i class="fas fa-home nav-icon"></i>Home</a>
      <a href="/SafetyHelp/resources.html"><i class="fas fa-book nav-icon"></i>Resources</a>
      <a href="/SafetyHelp/services.html"><i class="fas fa-concierge-bell nav-icon"></i>Services</a>
      <a href="/SafetyHelp/community.html"><i class="fas fa-users nav-icon"></i>Community</a>
      <a href="/SafetyHelp/about.html"><i class="fas fa-info-circle nav-icon"></i>About</a>
      <a href="/SafetyHelp/contact.html"><i class="fas fa-envelope nav-icon"></i>Contact</a>
      <a href="/SafetyHelp/login.html"><i class="fas fa-sign-in-alt nav-icon"></i>SignUp / Login</a>
    </nav>
    <div class="search-language">
      <input type="text" placeholder="Search...">
      <select>
        <option>English</option>
        <option>isiXhosa</option>
        <option>Afrikaans</option>
      </select>
    </div>
  </header>

  <div class="page-title-section">
    <h1 id="subpage-title">OHS System Management</h1>
    <p class="subtitle" id="subpage-subtitle">Develop and customize your comprehensive OHS Management System documents, aligned with ISO 45001 and South African legislation.</p>
  </div>

  <div class="page-content-container">
    <div class="container-grid">
      <aside class="sidebar-tools">
        <h3 class="sidebar-heading"><i class="fas fa-tools heading-icon"></i>SafetyHelp Tools</h3>
        <div class="sidebar-list-container">
          <ul id="safetyhelp-tools-list">
            <li><a href="/SafetyHelp/pages/construction-compliance.html" data-modulename="Construction Safety" data-detail="Comprehensive safety management for construction projects."><i class="fas fa-hard-hat list-icon"></i>Construction Safety</a></li>
            <li><a href="/SafetyHelp/pages/emergency-response-plan.html" data-modulename="Emergency Planning" data-detail="Develop effective emergency plans."><i class="fas fa-bell list-icon"></i>Emergency Planning</a></li>
            <li><a href="/SafetyHelp/pages/risk-assessment.html" data-modulename="Risk Assessment" data-detail="Identify and control workplace hazards."><i class="fas fa-shield-alt list-icon"></i>Risk Assessment</a></li>
            <li><a href="/SafetyHelp/pages/legal-appointments.html" data-modulename="Legal Appointments" data-detail="Manage OHS legal appointments."><i class="fas fa-gavel list-icon"></i>Legal Appointments</a></li>
            <li><a href="/SafetyHelp/pages/incident-management.html" data-modulename="Incident Management" data-detail="Report and investigate incidents."><i class="fas fa-file-medical-alt list-icon"></i>Incident Management</a></li>
            <li><a href="/SafetyHelp/pages/training.html" data-modulename="Training" data-detail="Access OHS training programs."><i class="fas fa-graduation-cap list-icon"></i>Training</a></li>
            <li><a href="/SafetyHelp/pages/inspections-audits.html" data-modulename="Inspections & Audits" data-detail="Conduct workplace inspections and audits."><i class="fas fa-clipboard-check list-icon"></i>Inspections & Audits</a></li>
            <li><a href="/SafetyHelp/pages/suppliers.html" data-modulename="Suppliers" data-detail="Manage supplier OHS compliance."><i class="fas fa-truck list-icon"></i>Suppliers</a></li>
            <li><a href="/SafetyHelp/pages/legislation.html" data-modulename="Legislation" data-detail="Stay updated with OHS legislation."><i class="fas fa-balance-scale list-icon"></i>Legislation</a></li>
            <li><a href="/SafetyHelp/pages/community-tools.html" data-modulename="Community Tools" data-detail="Engage with the OHS community."><i class="fas fa-users list-icon"></i>Community Tools</a></li>
            <li><a href="/SafetyHelp/member-dashboard.html" data-modulename="Member Dashboard" data-detail="Your personalized OHS dashboard."><i class="fas fa-tachometer-alt list-icon"></i>Member Dashboard</a></li>
            <li><a href="/SafetyHelp/pages/ohs-system.html" data-modulename="OHS System Modules" data-detail="Build a comprehensive OHS system."><i class="fas fa-cogs list-icon"></i>OHS System Modules</a></li>
          </ul>
        </div>
      </aside>

      <main class="main-subpage-content">
        <!-- Introduction Section (Retained from subpage_Final.html, can be customized for OHS System) -->
        <section id="introduction-section">
          <h2><i class="fas fa-info-circle section-icon"></i>Welcome to the OHS System Builder</h2>
          <p>This module is designed to help you create a comprehensive Occupational Health and Safety (OHS) Management System tailored to your organization's needs. By following the steps, you can generate policies, procedures, and other essential documents to ensure compliance with South African legislation (like the OHS Act 85 of 1993) and align with international standards such as ISO 45001.</p>
          <p>Choose one of the methods below to get started. Whether you prefer a guided approach or want to select documents manually, SafetyHelp is here to simplify your compliance journey.</p>
        </section>

        <!-- Interaction Choice Section -->
        <section id="interaction-choice-section">
          <h2><i class="fas fa-cogs section-icon"></i>How Would You Like to Build Your OHS System?</h2>
          <p>Select your preferred method to start compiling your OHS documentation.</p>
          <div class="interaction-buttons-container">
            <button id="show-automated-wizard-btn" class="action-button action-button-primary">
              <i class="fas fa-magic"></i>Automated Wizard
            </button>
            <button id="show-semi-automated-btn" class="action-button action-button-tertiary"> <!-- Changed color for differentiation -->
              <i class="fas fa-tasks-alt"></i>Semi-Automated Selection
            </button>
            <button id="show-manual-btn" class="action-button action-button-secondary">
              <i class="fas fa-list-ul"></i>Manual Selection
            </button>
          </div>
        </section>

        <!-- Manual Selection Section (Populated with OHS System Structure) -->
        <section id="manual-selection-section" class="hidden">
          <h2><i class="fas fa-list-ul section-icon"></i>Manual Document Selection for OHS System</h2>
          <p>Browse the categories below and select the specific documents you need to build your OHS Management System. Once selected, you can proceed to customize them with your company's information.</p>
          <div class="document-category-list" id="manual-document-categories">
            <!-- Categories will be dynamically inserted here by JavaScript -->
          </div>
          <div class="nav-buttons">
            <button id="manual-proceed-btn" class="action-button action-button-primary">Proceed to Company Details <i class="fas fa-arrow-right"></i></button>
          </div>
        </section>

        <!-- Automated Wizard Section -->
        <section id="automated-wizard-section" class="hidden">
          <h2><i class="fas fa-magic section-icon"></i>Automated OHS System Wizard</h2>
          
          <!-- Step 1: Role & Experience -->
          <div id="wizard-step-1" class="wizard-step">
            <h3>Step 1: Your Role & OHS Experience</h3>
            <div class="form-group">
              <label for="user-role">Your Primary Role:</label>
              <select id="user-role" name="user-role">
                <option value="">-- Select Your Role --</option>
                <option value="owner_ceo_director">Company Owner / CEO / Director</option>
                <option value="ohs_professional">OHS Professional (Manager, Officer, Consultant)</option>
                <option value="contractor">Contractor / Subcontractor</option>
                <option value="client_property_owner">Client / Property Owner (Procuring Services)</option>
                <option value="employer_manager">Employer / Line Manager / Supervisor</option>
                <option value="employee_worker">Employee / Worker</option>
                <option value="community_leader">Community Leader / NPO Representative</option>
                <option value="student_trainee">Student / Trainee in OHS</option>
                <option value="other">Other</option>
              </select>
              <p class="error-message hidden" id="user-role-error">Please select your role.</p>
            </div>
            <div class="form-group">
              <label for="ohs-knowledge">Your OHS Knowledge Level:</label>
              <select id="ohs-knowledge" name="ohs-knowledge">
                <option value="">-- Select Knowledge Level --</option>
                <option value="beginner">Beginner (New to OHS concepts)</option>
                <option value="intermediate">Intermediate (Familiar with basics, some experience)</option>
                <option value="advanced">Advanced (Experienced, in-depth knowledge)</option>
              </select>
              <p class="error-message hidden" id="ohs-knowledge-error">Please select your OHS knowledge level.</p>
            </div>
            <div class="form-group">
                <label for="role-experience">Years of Experience in Current Role:</label>
                <select id="role-experience" name="role-experience">
                    <option value="">-- Select Experience --</option>
                    <option value="0-1">Less than 1 year</option>
                    <option value="1-3">1-3 years</option>
                    <option value="3-5">3-5 years</option>
                    <option value="5+">5+ years</option>
                </select>
                <p class="error-message hidden" id="role-experience-error">Please select your years of experience.</p>
            </div>
            <div class="nav-buttons">
              <button class="action-button action-button-secondary wizard-prev-btn" style="display: none;">Back</button> <!-- Hidden on first step -->
              <button class="action-button action-button-primary wizard-next-btn">Next <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>

          <!-- Step 2: Company Profile -->
          <div id="wizard-step-2" class="wizard-step hidden">
            <h3>Step 2: Company Profile</h3>
            <div class="form-group">
              <label for="industry-type">Primary Industry:</label>
              <select id="industry-type" name="industry-type">
                <option value="">-- Select Industry --</option>
                <option value="office_administrative">Office / Administrative</option>
                <option value="retail_shops">Retail / Shops (including Spaza Shops)</option>
                <option value="hospitality_restaurants_hotels">Hospitality (Restaurants, Hotels)</option>
                <option value="construction_small_residential">Construction (Small Residential)</option>
                <option value="construction_commercial_industrial">Construction (Commercial / Industrial)</option>
                <option value="manufacturing_light">Manufacturing (Light)</option>
                <option value="manufacturing_heavy">Manufacturing (Heavy)</option>
                <option value="mining_surface">Mining (Surface)</option>
                <option value="mining_underground">Mining (Underground)</option>
                <option value="agriculture_farming">Agriculture / Farming</option>
                <option value="healthcare_clinics_hospitals">Healthcare (Clinics, Hospitals)</option>
                <option value="education_schools_universities">Education (Schools, Universities)</option>
                <option value="transport_logistics">Transport & Logistics</option>
                <option value="chemical_petrochemical">Chemical / Petrochemical</option>
                <option value="community_religious_orgs">Community / Religious Organizations / NPOs</option>
                <option value="other_industry">Other (Please specify if possible)</option>
              </select>
              <p class="error-message hidden" id="industry-type-error">Please select your industry.</p>
            </div>
             <div class="form-group">
                <label for="company-status">Company Status:</label>
                <select id="company-status" name="company-status">
                    <option value="">-- Select Status --</option>
                    <option value="new_venture">New Venture (Just Starting/Planning)</option>
                    <option value="established_lessthan_2_years">Established Business (Operating < 2 years)</option>
                    <option value="mature_organization">Mature Organization (Operating > 2 years)</option>
                </select>
                <p class="error-message hidden" id="company-status-error">Please select your company status.</p>
            </div>
            <div class="form-group">
              <label for="employee-count">Number of Employees:</label>
              <select id="employee-count" name="employee-count">
                <option value="">-- Select Number of Employees --</option>
                <option value="1-10">1-10</option>
                <option value="11-50">11-50</option>
                <option value="51-200">51-200</option>
                <option value="201-500">201-500</option>
                <option value="500+">500+</option>
              </select>
              <p class="error-message hidden" id="employee-count-error">Please select the number of employees.</p>
            </div>
            <div class="nav-buttons">
              <button class="action-button action-button-secondary wizard-prev-btn">Back <i class="fas fa-arrow-left"></i></button>
              <button class="action-button action-button-primary wizard-next-btn">Next <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>

          <!-- Step 3: Document Recommendations -->
          <div id="wizard-step-3" class="wizard-step hidden">
            <h3>Step 3: Recommended OHS System Documents</h3>
            <p>Based on your selections, we recommend the following documents for your OHS Management System. You can refine this selection.</p>
            <div id="automated-document-recommendations" class="document-category-list">
              <!-- Recommendations will be populated here by JavaScript -->
            </div>
            <p class="error-message hidden" id="automated-documents-error">Please select at least one document.</p>
            <div class="nav-buttons">
              <button class="action-button action-button-secondary wizard-prev-btn">Back <i class="fas fa-arrow-left"></i></button>
              <button class="action-button action-button-primary wizard-next-btn">Proceed to Company Details <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>
        </section>

        <!-- Semi-Automated Selection Section -->
        <section id="semi-automated-selection-section" class="hidden">
            <h2><i class="fas fa-tasks-alt section-icon"></i>Semi-Automated OHS System Builder</h2>
            <!-- Step 1: Focus Areas -->
            <div id="semi-wizard-step-1" class="wizard-step">
                <h3>Step 1: Identify Key OHS Focus Areas</h3>
                <p>Select the main areas of OHS management relevant to your organization.</p>
                <div class="form-group">
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="focus-area" value="policy_leadership"> Policy & Leadership</label>
                        <label><input type="checkbox" name="focus-area" value="planning_risk_management"> Planning & Risk Management</label>
                        <label><input type="checkbox" name="focus-area" value="implementation_operation"> Implementation & Operation</label>
                        <label><input type="checkbox" name="focus-area" value="emergency_preparedness"> Emergency Preparedness</label>
                        <label><input type="checkbox" name="focus-area" value="checking_monitoring"> Checking & Monitoring (Incidents, Audits)</label>
                        <label><input type="checkbox" name="focus-area" value="system_review_improvement"> System Review & Improvement</label>
                    </div>
                    <p class="error-message hidden" id="focus-area-error">Please select at least one focus area.</p>
                </div>
                <div class="nav-buttons">
                     <button class="action-button action-button-secondary wizard-prev-btn" style="display: none;">Back</button>
                    <button class="action-button action-button-primary wizard-next-btn">Next <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
            <!-- Step 2: Select Document Categories -->
            <div id="semi-wizard-step-2" class="wizard-step hidden">
                <h3>Step 2: Select Relevant Document Categories</h3>
                <p>Based on your focus areas, we suggest these document categories. Refine your selection.</p>
                <div id="semi-automated-category-recommendations" class="document-category-list">
                    <!-- Categories will be populated here -->
                </div>
                 <p class="error-message hidden" id="semi-categories-error">Please select at least one document category.</p>
                <div class="nav-buttons">
                    <button class="action-button action-button-secondary wizard-prev-btn">Back <i class="fas fa-arrow-left"></i></button>
                    <button class="action-button action-button-primary wizard-next-btn">Next <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
            <!-- Step 3: Select Specific Documents -->
            <div id="semi-wizard-step-3" class="wizard-step hidden">
                <h3>Step 3: Select Specific Documents</h3>
                <p>Choose the specific documents you need from the selected categories.</p>
                <div id="semi-automated-document-selection" class="document-category-list">
                    <!-- Specific documents will be populated here -->
                </div>
                <p class="error-message hidden" id="semi-documents-error">Please select at least one document.</p>
                <div class="nav-buttons">
                    <button class="action-button action-button-secondary wizard-prev-btn">Back <i class="fas fa-arrow-left"></i></button>
                    <button class="action-button action-button-primary wizard-next-btn">Proceed to Company Details <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
        </section>
        
        <!-- Common Step: Company Details -->
        <section id="company-details-section" class="wizard-step hidden">
            <h3>Enter Company Information</h3>
            <p>Please provide the following details to customize your OHS documents.</p>
            <div class="form-group">
                <label for="company-name">Company Name:</label>
                <input type="text" id="company-name" name="company-name" required>
                <p class="error-message hidden" id="company-name-error">Company name is required.</p>
            </div>
            <div class="form-group">
                <label for="company-reg-number">Company Registration Number (Optional):</label>
                <input type="text" id="company-reg-number" name="company-reg-number">
            </div>
            <div class="form-group">
                <label for="company-address-physical">Physical Address:</label>
                <textarea id="company-address-physical" name="company-address-physical" rows="3" required></textarea>
                <p class="error-message hidden" id="company-address-physical-error">Physical address is required.</p>
            </div>
            <div class="form-group">
                <label for="company-address-postal">Postal Address (Optional):</label>
                <textarea id="company-address-postal" name="company-address-postal" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="company-contact-number">Main Contact Number:</label>
                <input type="tel" id="company-contact-number" name="company-contact-number" required>
                <p class="error-message hidden" id="company-contact-number-error">A valid contact number is required.</p>
            </div>
            <div class="form-group">
                <label for="company-email">Main Company Email:</label>
                <input type="email" id="company-email" name="company-email" required>
                 <p class="error-message hidden" id="company-email-error">A valid email is required.</p>
            </div>
            <div class="form-group">
                <label for="company-website">Company Website (Optional):</label>
                <input type="text" id="company-website" name="company-website">
            </div>
            <div class="form-group">
                <label for="ceo-name">Name of CEO / Managing Director (for policy signatures):</label>
                <input type="text" id="ceo-name" name="ceo-name" required>
                <p class="error-message hidden" id="ceo-name-error">CEO/MD name is required.</p>
            </div>
            <div class="form-group">
                <label for="ohs-manager-name">Name of OHS Manager/Representative (Optional):</label>
                <input type="text" id="ohs-manager-name" name="ohs-manager-name">
            </div>
             <div class="form-group">
                <label for="date-first-operated">Date Company First Operated (Approximate if new):</label>
                <input type="date" id="date-first-operated" name="date-first-operated" required>
                <p class="error-message hidden" id="date-first-operated-error">Date of first operation is required.</p>
            </div>
            <div class="form-group">
                <label for="company-turnover">Annual Turnover (Optional, for context):</label>
                <select id="company-turnover" name="company-turnover">
                    <option value="">-- Select Turnover Range --</option>
                    <option value="<R1M">&lt; R1 Million</option>
                    <option value="R1M-R5M">R1 Million - R5 Million</option>
                    <option value="R5M-R20M">R5 Million - R20 Million</option>
                    <option value="R20M-R50M">R20 Million - R50 Million</option>
                    <option value=">R50M">&gt; R50 Million</option>
                </select>
            </div>
             <div class="form-group">
                <label for="project-name">Project Name (if documents are for a specific project, otherwise leave blank):</label>
                <input type="text" id="project-name" name="project-name">
            </div>
            <div class="form-group">
                <label for="site-address">Site Address (if different from company address, or for a specific project):</label>
                <textarea id="site-address" name="site-address" rows="2"></textarea>
            </div>
            <hr style="margin: 2rem 0;">
            <h4>Your Details (Person Compiling)</h4>
            <div class="form-group">
                <label for="compiler-name">Your Full Name:</label>
                <input type="text" id="compiler-name" name="compiler-name" required>
                 <p class="error-message hidden" id="compiler-name-error">Your name is required.</p>
            </div>
             <div class="form-group">
                <label for="compiler-role">Your Role/Designation:</label>
                <input type="text" id="compiler-role" name="compiler-role" required>
                <p class="error-message hidden" id="compiler-role-error">Your role is required.</p>
            </div>
            <div class="form-group">
                <label for="compiler-contact">Your Contact Number:</label>
                <input type="tel" id="compiler-contact" name="compiler-contact" required>
                <p class="error-message hidden" id="compiler-contact-error">Your contact number is required.</p>
            </div>
             <div class="form-group">
                <label for="compiler-email">Your Email Address:</label>
                <input type="email" id="compiler-email" name="compiler-email" required>
                <p class="error-message hidden" id="compiler-email-error">Your email is required.</p>
            </div>
            <div class="form-group">
                <label for="compiler-sacpcmp">SACPCMP Registration Number (if applicable):</label>
                <input type="text" id="compiler-sacpcmp" name="compiler-sacpcmp">
            </div>
            <div class="nav-buttons">
              <button class="action-button action-button-secondary wizard-prev-btn">Back <i class="fas fa-arrow-left"></i></button>
              <button class="action-button action-button-primary wizard-next-btn">Review Documents <i class="fas fa-arrow-right"></i></button>
            </div>
        </section>

        <!-- Common Step: Review & Customize Documents -->
        <section id="document-review-section" class="wizard-step hidden">
            <h3>Review Your OHS System Documents</h3>
            <p>Below is a preview of the documents you've selected, populated with your company information. Please review carefully. You can make minor edits here if needed, or download the source files for more extensive changes later.</p>
            <div id="document-preview-area">
                <!-- Document previews will be loaded here by JavaScript -->
            </div>
            <div class="nav-buttons">
              <button class="action-button action-button-secondary wizard-prev-btn">Back <i class="fas fa-arrow-left"></i></button>
              <button class="action-button action-button-primary wizard-next-btn">Finalize & Checkout <i class="fas fa-credit-card"></i></button>
            </div>
        </section>

        <!-- Common Step: Finalize & Checkout -->
        <section id="checkout-section" class="wizard-step hidden">
            <h3>Finalize & Download Your OHS System</h3>
            <p>Your OHS Management System documents are ready. Please review the summary below.</p>
            <div class="review-section">
                <h4>Selected Documents:</h4>
                <ul id="final-document-list"></ul>
            </div>
             <div class="review-section">
                <h4>Company Details:</h4>
                <p><strong>Company Name:</strong> <span id="final-company-name"></span></p>
                <p><strong>CEO:</strong> <span id="final-ceo-name"></span></p>
                <p><strong>Compiled By:</strong> <span id="final-compiler-name"></span> (<span id="final-compiler-role"></span>)</p>
            </div>
            <p><em>Disclaimer: These documents are generated based on the information you provided and standard templates. It is your responsibility to ensure they meet all specific legal and operational requirements for your organization. SafetyHelp recommends review by a qualified OHS professional.</em></p>
            <div class="nav-buttons">
              <button class="action-button action-button-secondary wizard-prev-btn">Back <i class="fas fa-arrow-left"></i></button>
              <button id="download-documents-btn" class="action-button action-button-primary"><i class="fas fa-download"></i> Download Documents (PDF)</button>
            </div>
        </section>

      </main>

      <aside class="sidebar-milestones">
        <h3 class="sidebar-heading"><i class="fas fa-flag-checkered heading-icon"></i>OHS Milestones</h3>
        <div class="sidebar-list-container">
          <ul id="ohs-milestones-list">
            <li data-detail="Ancient Egyptians used linen strips to bind wounds, an early form of first aid, reflecting basic safety practices. <a href='https://www.history.com/topics/ancient-egypt' target='_blank' rel='noopener noreferrer'>Source</a>"><i class="fas fa-landmark list-icon"></i>3000 BC: Early First Aid (Egypt)</li>
            <li data-detail="Hippocrates documented lead poisoning effects, marking an early recognition of occupational health hazards. <a href='https://www.britannica.com/biography/Hippocrates' target='_blank' rel='noopener noreferrer'>Source</a>"><i class="fas fa-landmark list-icon"></i>400 BC: Lead Poisoning (Greece)</li>
            <li data-detail="Pliny the Elder recommended masks for workers exposed to dust, an early OHS intervention. <a href='https://www.britannica.com/biography/Pliny-the-Elder' target='_blank' rel='noopener noreferrer'>Source</a>"><i class="fas fa-landmark list-icon"></i>50 AD: Protective Masks (Rome)</li>
            <li data-detail="Khoisan people in South Africa used herbal remedies for injuries, laying foundations for traditional safety practices. <a href='https://www.sahistory.org.za/article/khoisan' target='_blank' rel='noopener noreferrer'>Source</a>"><i class="fas fa-landmark list-icon"></i>1000 AD: Khoisan Healing (SA)</li>
            <li data-detail="Bantu-speaking peoples developed mining techniques, facing risks like cave-ins, early occupational hazards in SA. <a href='https://www.sahistory.org.za/article/bantu-migration' target='_blank' rel='noopener noreferrer'>Source</a>"><i class="fas fa-landmark list-icon"></i>1200 AD: Early Mining (SA)</li>
            </ul>
        </div>
      </aside>
    </div>
  </div>

  <footer>
    <p>&copy; <span id="copyright-year"></span> SafetyHelp. All rights reserved. Your Partner in Occupational Health and Safety Compliance.</p>
    <p><a href="/SafetyHelp/privacy.html">Privacy Policy</a> | <a href="/SafetyHelp/terms.html">Terms of Service</a> | <a href="/SafetyHelp/contact.html">Contact Us</a></p>
  </footer>

  <div id="infoModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h4 id="modalTitle">Milestone Detail</h4>
        <span class="close-btn" onclick="closeModal()">&times;</span>
      </div>
      <div class="modal-body" id="modalBody"></div>
      <div class="modal-footer">
        <button onclick="closeModal()" class="action-button action-button-secondary"><i class="fas fa-times"></i>Close</button>
      </div>
    </div>
  </div>

  <div class="chatbot-container">
      <div id="chat-window" class="chat-hidden">
          <div id="chat-header">
              <span>Salatiso - Your OHS Assistant</span>
              <button class="close-chat-btn" onclick="toggleChatbot(false)">&times;</button>
          </div>
          <div id="chat-output">
              <p><strong>Salatiso:</strong> Hello! How can I help you with OHS today?</p>
          </div>
          <div id="chat-input-container">
              <input id="chat-input" type="text" placeholder="Ask about OHS...">
              <button id="chat-send"><i class="fas fa-paper-plane"></i></button>
          </div>
      </div>
      <button id="chat-toggle" onclick="toggleChatbot()">
          <i class="fas fa-headset"></i>
      </button>
  </div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // --- Basic Setup ---
    const copyrightYearEl = document.getElementById('copyright-year');
    if (copyrightYearEl) {
        copyrightYearEl.textContent = new Date().getFullYear();
    }
    
    const modal = document.getElementById('infoModal');
    const modalTitleEl = document.getElementById('modalTitle');
    const modalBodyEl = document.getElementById('modalBody');

    function handleMilestoneClick(item) {
        const title = item.textContent.trim().replace(/^.*? /, ''); 
        const detail = item.dataset.detail || "More information about this milestone will be available soon.";
        if (modalTitleEl) modalTitleEl.textContent = `OHS Milestone: ${title}`;
        if (modalBodyEl) modalBodyEl.innerHTML = `<p>${detail.replace(/<a href=/g, '<a target="_blank" rel="noopener noreferrer" href=')}</p>`;
        if (modal) modal.style.display = 'block';
    }

    function setupMilestonesScrolling(listId) {
        const listElement = document.getElementById(listId);
        if (!listElement || listElement.children.length === 0) return;
        const originalItems = Array.from(listElement.children);
        if (originalItems.length === 0) return;
        originalItems.forEach(item => {
            const clone = item.cloneNode(true);
            clone.addEventListener('click', () => handleMilestoneClick(clone));
            listElement.appendChild(clone);
        });
        originalItems.forEach(item => {
            item.addEventListener('click', () => handleMilestoneClick(item));
        });
        const listContainer = listElement.parentElement;
        if (listElement.offsetHeight > listContainer.offsetHeight) {
            const duration = Math.max(20, Math.round(listElement.offsetHeight / 50)) ;
            listElement.style.animation = `continuousScrollUp ${duration}s linear infinite`;
        }
    }
    setupMilestonesScrolling('ohs-milestones-list');

    window.closeModal = function() {
      if (modal) modal.style.display = 'none';
      const customMsgModal = document.getElementById('customMessageModal');
      if (customMsgModal) customMsgModal.remove();
    }
    window.onclick = function(event) {
      if (event.target == modal) closeModal();
      const customMsgModal = document.getElementById('customMessageModal');
      if (event.target == customMsgModal) closeModal();
    }

    // --- Chatbot ---
    const chatWindow = document.getElementById('chat-window');
    const chatToggleBtn = document.getElementById('chat-toggle');
    const chatInputEl = document.getElementById('chat-input');
    const chatSendBtn = document.getElementById('chat-send');
    const chatOutputEl = document.getElementById('chat-output');
    let chatbotIsVisible = false; 

    window.toggleChatbot = function(forceState) { 
      if (!chatWindow || !chatToggleBtn) return;
      const shouldOpen = forceState !== undefined ? forceState : !chatbotIsVisible;
      chatWindow.classList.toggle('chat-hidden', !shouldOpen);
      chatWindow.classList.toggle('chat-expanded', shouldOpen);
      chatToggleBtn.innerHTML = shouldOpen ? '<i class="fas fa-times"></i>' : '<i class="fas fa-headset"></i>';
      if (shouldOpen && chatInputEl) chatInputEl.focus();
      chatbotIsVisible = shouldOpen;
    }

    function addChatMessageToUI(sender, message, isUser) { /* ... Omitted for brevity, same as before ... */ }
    async function handleChatSend() { /* ... Omitted for brevity, same as before ... */ }
    if (chatSendBtn) chatSendBtn.addEventListener('click', handleChatSend);
    if (chatInputEl) chatInputEl.addEventListener('keypress', e => { if (e.key === 'Enter') handleChatSend(); });
    if (chatWindow) {
        chatWindow.classList.add('chat-hidden'); 
        chatWindow.classList.remove('chat-expanded');
    }
    if (chatToggleBtn) chatToggleBtn.innerHTML = '<i class="fas fa-headset"></i>';

    // --- OHS System Wizard Logic ---
    const interactionChoiceSection = document.getElementById('interaction-choice-section');
    const manualSelectionSection = document.getElementById('manual-selection-section');
    const automatedWizardSection = document.getElementById('automated-wizard-section');
    const semiAutomatedSelectionSection = document.getElementById('semi-automated-selection-section');
    const companyDetailsSection = document.getElementById('company-details-section');
    const documentReviewSection = document.getElementById('document-review-section');
    const checkoutSection = document.getElementById('checkout-section');

    const allWizardProcessSections = [
        manualSelectionSection, automatedWizardSection, semiAutomatedSelectionSection, 
        companyDetailsSection, documentReviewSection, checkoutSection
    ];

    let currentWizardMode = ''; // 'manual', 'automated', 'semi-automated'
    let currentWizardStep = 0;
    let wizardStepsInSection = [];
    let selectedDocuments = [];
    let companyData = {};

    const ohsSystemCategories = {
        "1": { name: "OHS Policy", icon: "fas fa-file-contract", documents: [
            { id: "ohs_policy_document", name: "OHS Policy Document", description: "Overall statement of OHS commitment."}
        ]},
        "2": { name: "Planning", icon: "fas fa-tasks", subcategories: {
            "2.1": { name: "Hazard Identification, Risk Assessment and Mitigation", icon: "fas fa-shield-alt", documents: [
                { id: "hira_procedure", name: "HIRA Procedure", description: "Process for identifying hazards and assessing risks." },
                { id: "risk_assessment_template", name: "Risk Assessment Template", description: "Form for conducting risk assessments." },
                { id: "risk_register_template", name: "Risk Register Template", description: "Log of identified risks and controls." }
            ]},
            "2.2": { name: "Legal and other requirements", icon: "fas fa-balance-scale", documents: [
                { id: "legal_register_template", name: "Legal Register Template", description: "List of applicable OHS legislation." },
                { id: "compliance_evaluation_checklist", name: "Compliance Evaluation Checklist", description: "Tool to check adherence to legal requirements." }
            ]},
            "2.3": { name: "OHS Objectives and Targets", icon: "fas fa-bullseye", documents: [
                { id: "ohs_objectives_procedure", name: "OHS Objectives Procedure", description: "Process for setting and reviewing OHS goals." },
                { id: "objectives_tracker_template", name: "Objectives Tracker Template", description: "Form to monitor progress towards OHS targets." }
            ]}
        }},
        "3": { name: "Implementation and Operation", icon: "fas fa-cogs", subcategories: {
            "3.1": { name: "Resources and Roles", icon: "fas fa-users-cog", documents: [
                { id: "roles_responsibilities_procedure", name: "OHS Roles & Responsibilities Procedure", description: "Defines OHS duties for personnel." },
                { id: "appointment_letter_16_1", name: "16.1 CEO Appointment Letter Template", description: "Template for CEO OHS accountability." },
                { id: "appointment_letter_16_2", name: "16.2 Appointee Letter Template", description: "Template for delegating OHS duties." }
            ]},
            "3.2": { name: "Training, Awareness and Competence", icon: "fas fa-graduation-cap", documents: [
                { id: "training_procedure", name: "OHS Training Procedure", description: "Process for OHS training." },
                { id: "training_matrix_template", name: "Training Matrix Template", description: "Plan for required OHS training by role." },
                { id: "induction_checklist_template", name: "Induction Checklist Template", description: "Checklist for new employee OHS orientation." }
            ]},
            "3.3": { name: "Communication, Participation and Consultation", icon: "fas fa-comments", documents: [
                { id: "communication_procedure", name: "OHS Communication Procedure", description: "Process for OHS communication." },
                { id: "hs_committee_agenda_minutes_template", name: "H&S Committee Meeting Agenda/Minutes Template", description: "Templates for H&S committee meetings." }
            ]},
            "3.4": { name: "OHS Management System Documentation", icon: "fas fa-folder-open", documents: [
                { id: "document_control_procedure", name: "Document Control Procedure", description: "Process for managing OHS documents." },
                { id: "ohs_manual_template", name: "OHS System Manual Template", description: "Framework document for the OHS system." }
            ]},
            "3.5": { name: "Emergency Preparedness and Response", icon: "fas fa-fire-extinguisher", documents: [
                { id: "emergency_plan_template", name: "Emergency Response Plan Template", description: "Plan for handling emergencies." },
                { id: "evacuation_drill_record_template", name: "Evacuation Drill Record Template", description: "Form to document emergency drills." }
            ]},
            "3.6": { name: "Supplier/ Contractor OHS Compliance", icon: "fas fa-truck-loading", documents: [
                { id: "contractor_management_procedure", name: "Contractor Management Procedure", description: "Process for managing contractor OHS." },
                { id: "contractor_agreement_s37_2_template", name: "Section 37(2) Agreement Template", description: "Legal agreement with contractors." }
            ]}
        }},
        "4": { name: "Checking", icon: "fas fa-check-circle", subcategories: {
            "4.1": { name: "Incident Management", icon: "fas fa-first-aid", documents: [
                { id: "incident_reporting_investigation_procedure", name: "Incident Reporting & Investigation Procedure", description: "Process for handling incidents." },
                { id: "incident_report_form_template", name: "Incident Report Form Template", description: "Form for reporting incidents." }
            ]},
            "4.2": { name: "Non-Conformity, Corrective Action and Preventative Action", icon: "fas fa-wrench", documents: [
                { id: "corrective_action_procedure", name: "Corrective & Preventive Action Procedure", description: "Process for addressing non-conformities." },
                { id: "car_par_form_template", name: "CAR/PAR Form Template", description: "Form for corrective/preventive actions." }
            ]},
            "4.3": { name: "Records", icon: "fas fa-archive", documents: [
                { id: "records_control_procedure", name: "OHS Records Control Procedure", description: "Process for managing OHS records." }
            ]},
            "4.4": { name: "Audits and Inspections", icon: "fas fa-search-plus", documents: [
                { id: "audit_inspection_procedure", name: "OHS Audit & Inspection Procedure", description: "Process for conducting audits and inspections." },
                { id: "audit_checklist_template", name: "Audit Checklist Template", description: "Template for OHS audits." },
                { id: "inspection_checklist_template", name: "Workplace Inspection Checklist Template", description: "Template for site inspections." }
            ]}
        }},
        "5": { name: "System Review", icon: "fas fa-sync-alt", documents: [
            { id: "management_review_procedure", name: "Management Review Procedure", description: "Process for top management review of the OHS system." },
            { id: "management_review_minutes_template", name: "Management Review Minutes Template", description: "Template for recording review meetings." }
        ]}
    };

    function populateManualSelectionCategories() {
        const container = document.getElementById('manual-document-categories');
        container.innerHTML = ''; // Clear existing
        for (const catKey in ohsSystemCategories) {
            const category = ohsSystemCategories[catKey];
            const catDetails = document.createElement('details');
            const catSummary = document.createElement('summary');
            catSummary.innerHTML = `<i class="${category.icon} section-icon"></i> ${catKey}. ${category.name}`;
            catDetails.appendChild(catSummary);
            const catContent = document.createElement('div');

            if (category.documents) {
                category.documents.forEach(doc => {
                    catContent.appendChild(createDocumentItemCheckbox(doc.id, doc.name, doc.description, doc.icon || 'fas fa-file-alt'));
                });
            }
            if (category.subcategories) {
                for (const subCatKey in category.subcategories) {
                    const subCategory = category.subcategories[subCatKey];
                    const subCatDetails = document.createElement('details');
                    const subCatSummary = document.createElement('summary');
                    subCatSummary.innerHTML = `<i class="${subCategory.icon || 'fas fa-folder'} section-icon" style="margin-left: 1em;"></i> ${subCatKey} ${subCategory.name}`;
                    subCatDetails.appendChild(subCatSummary);
                    const subCatContent = document.createElement('div');
                    subCategory.documents.forEach(doc => {
                        subCatContent.appendChild(createDocumentItemCheckbox(doc.id, doc.name, doc.description, doc.icon || 'fas fa-file-invoice'));
                    });
                    subCatDetails.appendChild(subCatContent);
                    catContent.appendChild(subCatDetails);
                }
            }
            catDetails.appendChild(catContent);
            container.appendChild(catDetails);
        }
    }

    function createDocumentItemCheckbox(id, name, description, iconClass) {
        const div = document.createElement('div');
        div.className = 'document-item';
        div.innerHTML = `
            <input type="checkbox" id="manual_doc_${id}" name="manual_documents" value="${id}">
            <div class="document-item-info">
                <label for="manual_doc_${id}"><strong><i class="${iconClass}"></i> ${name}</strong></label>
                <p>${description}</p>
            </div>
        `;
        return div;
    }
    
    function hideAllProcessSections() {
        allWizardProcessSections.forEach(section => section.classList.add('hidden'));
        interactionChoiceSection.style.display = 'block'; // Always show interaction choice by default
        if (moduleSpecificResourcesSection) moduleSpecificResourcesSection.style.display = 'block'; // Show this too
    }

    function showSection(sectionElement) {
        hideAllProcessSections();
        interactionChoiceSection.style.display = 'none'; // Hide interaction choice when a process starts
        if (moduleSpecificResourcesSection) moduleSpecificResourcesSection.style.display = 'none';
        sectionElement.classList.remove('hidden');
    }
    
    function setupWizardNavigation(wizardSectionId, steps) {
        const wizardSection = document.getElementById(wizardSectionId);
        wizardStepsInSection = Array.from(wizardSection.querySelectorAll('.wizard-step'));
        
        wizardSection.querySelectorAll('.wizard-next-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Add validation logic here if needed for the current step
                // Example: if (!validateStep(currentWizardStep, wizardMode)) return;
                if (currentWizardStep < wizardStepsInSection.length - 1) {
                    currentWizardStep++;
                    showCurrentWizardStep();
                } else {
                    // Last step of this wizard section, move to common steps
                    collectAllSelectedDocuments(); // Ensure selectedDocuments is up to date
                    showSection(companyDetailsSection);
                    currentWizardStep = 0; // Reset for the common steps
                    wizardStepsInSection = [companyDetailsSection, documentReviewSection, checkoutSection];
                    showCurrentWizardStep(); // Show the company details form
                }
            });
        });

        wizardSection.querySelectorAll('.wizard-prev-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (currentWizardStep > 0) {
                    currentWizardStep--;
                    showCurrentWizardStep();
                } else {
                    // Back from the first step of a wizard mode, show interaction choices
                    hideAllProcessSections();
                }
            });
        });
    }

    function showCurrentWizardStep() {
        wizardStepsInSection.forEach((step, index) => {
            step.classList.toggle('hidden', index !== currentWizardStep);
        });
        // Update visibility of nav buttons based on current step in this section
        const currentSection = wizardStepsInSection[0].closest('section');
        const backBtn = currentSection.querySelector(`.wizard-step.hidden ~ .nav-buttons .wizard-prev-btn, .wizard-step:not(.hidden) .nav-buttons .wizard-prev-btn`);
        const nextBtn = currentSection.querySelector(`.wizard-step.hidden ~ .nav-buttons .wizard-next-btn, .wizard-step:not(.hidden) .nav-buttons .wizard-next-btn`);

        if (backBtn) backBtn.style.display = (currentWizardStep === 0 && currentSection !== companyDetailsSection) ? 'none' : 'inline-flex';
        // Logic for next/proceed buttons in common steps would be handled separately or by a final "Generate" button
    }
    
    document.getElementById('show-manual-btn').addEventListener('click', () => {
        currentWizardMode = 'manual';
        showSection(manualSelectionSection);
        populateManualSelectionCategories(); // Populate categories for manual selection
        // The "Proceed" button within manual selection will then move to company details
    });
    
    document.getElementById('manual-proceed-btn')?.addEventListener('click', () => {
        collectAllSelectedDocuments();
        if (selectedDocuments.length === 0) {
            showCustomMessage("Selection Required", "Please select at least one document to proceed.");
            return;
        }
        showSection(companyDetailsSection);
        currentWizardStep = 0;
        wizardStepsInSection = [companyDetailsSection, documentReviewSection, checkoutSection];
        showCurrentWizardStep();
    });

    document.getElementById('show-automated-wizard-btn').addEventListener('click', () => {
        currentWizardMode = 'automated';
        showSection(automatedWizardSection);
        currentWizardStep = 0;
        setupWizardNavigation('automated-wizard-section', wizardStepsInSection); // Pass the actual steps
        showCurrentWizardStep();
    });

    document.getElementById('show-semi-automated-btn').addEventListener('click', () => {
        currentWizardMode = 'semi-automated';
        showSection(semiAutomatedSelectionSection);
        currentWizardStep = 0;
        setupWizardNavigation('semi-automated-selection-section', wizardStepsInSection);
        // Populate initial step for semi-automated (e.g., focus areas)
        // For now, just show the first step
        const firstStep = semiAutomatedSelectionSection.querySelector('.wizard-step');
        if (firstStep) {
            wizardStepsInSection = Array.from(semiAutomatedSelectionSection.querySelectorAll('.wizard-step'));
            wizardStepsInSection.forEach(s => s.classList.add('hidden'));
            firstStep.classList.remove('hidden');
        }
        showCurrentWizardStep();
    });
    
    // Setup navigation for common steps (Company Details, Review, Checkout)
    // This needs to be callable after a wizard mode finishes its specific steps
    function setupCommonStepsNavigation() {
        wizardStepsInSection = [companyDetailsSection, documentReviewSection, checkoutSection];
        
        companyDetailsSection.querySelector('.wizard-next-btn').onclick = () => {
            if (validateCompanyDetails()) {
                collectCompanyDetails();
                populateReviewSection();
                currentWizardStep = 1; // Move to review section
                showCurrentWizardStep();
            }
        };
        companyDetailsSection.querySelector('.wizard-prev-btn').onclick = () => {
            // Go back to the last step of the previous mode or interaction choice
            hideAllProcessSections(); // This will show interaction choice by default
            // More specific back logic might be needed depending on how currentWizardMode is managed globally
        };

        documentReviewSection.querySelector('.wizard-next-btn').onclick = () => {
            populateCheckoutSection();
            currentWizardStep = 2; // Move to checkout
            showCurrentWizardStep();
        };
        documentReviewSection.querySelector('.wizard-prev-btn').onclick = () => {
            currentWizardStep = 0; // Back to company details
            showCurrentWizardStep();
        };
        
        checkoutSection.querySelector('.wizard-prev-btn').onclick = () => {
            currentWizardStep = 1; // Back to review
            showCurrentWizardStep();
        };
    }
    setupCommonStepsNavigation(); // Call it once to set up listeners for these common sections

    function collectAllSelectedDocuments() {
        selectedDocuments = [];
        if (currentWizardMode === 'manual') {
            document.querySelectorAll('input[name="manual_documents"]:checked').forEach(cb => {
                selectedDocuments.push(cb.value);
            });
        } else if (currentWizardMode === 'automated') {
            // Logic for collecting from automated wizard's recommendation step
            document.querySelectorAll('#automated-document-recommendations input[type="checkbox"]:checked').forEach(cb => {
                selectedDocuments.push(cb.value);
            });
        } else if (currentWizardMode === 'semi-automated') {
            // Logic for collecting from semi-automated wizard's document selection step
             document.querySelectorAll('#semi-automated-document-selection input[type="checkbox"]:checked').forEach(cb => {
                selectedDocuments.push(cb.value);
            });
        }
        console.log("Collected documents:", selectedDocuments);
    }
    
    function validateCompanyDetails() {
        let isValid = true;
        const fields = [
            {id: 'company-name', errorId: 'company-name-error', msg: 'Company name is required.'},
            {id: 'company-address-physical', errorId: 'company-address-physical-error', msg: 'Physical address is required.'},
            {id: 'company-contact-number', errorId: 'company-contact-number-error', msg: 'A valid contact number is required.', pattern: /^\+?\d{10,}$/},
            {id: 'company-email', errorId: 'company-email-error', msg: 'A valid email is required.', pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/},
            {id: 'ceo-name', errorId: 'ceo-name-error', msg: 'CEO/MD name is required.'},
            {id: 'date-first-operated', errorId: 'date-first-operated-error', msg: 'Date of first operation is required.'},
            {id: 'compiler-name', errorId: 'compiler-name-error', msg: 'Your name is required.'},
            {id: 'compiler-role', errorId: 'compiler-role-error', msg: 'Your role is required.'},
            {id: 'compiler-contact', errorId: 'compiler-contact-error', msg: 'Your contact number is required.', pattern: /^\+?\d{10,}$/},
            {id: 'compiler-email', errorId: 'compiler-email-error', msg: 'Your email is required.', pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/}
        ];

        fields.forEach(field => {
            const inputEl = document.getElementById(field.id);
            const errorEl = document.getElementById(field.errorId);
            let fieldValue = inputEl.value.trim();
            let fieldValid = true;

            if (!fieldValue) {
                fieldValid = false;
            } else if (field.pattern && !field.pattern.test(fieldValue)) {
                fieldValid = false;
            }

            if (!fieldValid) {
                errorEl.textContent = field.msg;
                errorEl.classList.remove('hidden');
                isValid = false;
            } else {
                errorEl.classList.add('hidden');
            }
        });
        return isValid;
    }

    function collectCompanyDetails() {
        companyData = {
            COMPANY_NAME: document.getElementById('company-name').value,
            COMPANY_REG_NUMBER: document.getElementById('company-reg-number').value,
            COMPANY_ADDRESS_PHYSICAL: document.getElementById('company-address-physical').value,
            COMPANY_ADDRESS_POSTAL: document.getElementById('company-address-postal').value,
            COMPANY_CONTACT_NUMBER: document.getElementById('company-contact-number').value,
            COMPANY_EMAIL: document.getElementById('company-email').value,
            COMPANY_WEBSITE: document.getElementById('company-website').value,
            CEO_NAME: document.getElementById('ceo-name').value,
            OHS_MANAGER_NAME: document.getElementById('ohs-manager-name').value,
            DATE_FIRST_OPERATED: document.getElementById('date-first-operated').value,
            COMPANY_TURNOVER: document.getElementById('company-turnover').value,
            PROJECT_NAME: document.getElementById('project-name').value,
            SITE_ADDRESS: document.getElementById('site-address').value,
            COMPILED_BY_NAME: document.getElementById('compiler-name').value,
            COMPILED_BY_ROLE: document.getElementById('compiler-role').value,
            COMPILED_BY_CONTACT: document.getElementById('compiler-contact').value,
            COMPILED_BY_EMAIL: document.getElementById('compiler-email').value,
            SACPCMP_NUMBER: document.getElementById('compiler-sacpcmp').value,
            DATE: new Date().toLocaleDateString('en-ZA') // Example: 2024/05/28
        };
        console.log("Collected company data:", companyData);
    }

    function populateReviewSection() {
        const previewArea = document.getElementById('document-preview-area');
        previewArea.innerHTML = ''; // Clear previous previews

        if (selectedDocuments.length === 0) {
            previewArea.innerHTML = "<p>No documents selected for review.</p>";
            return;
        }
        
        selectedDocuments.forEach(docId => {
            // This is a placeholder. In a real scenario, you'd fetch the template
            // content (e.g., from the LaTeX strings or a simplified HTML version)
            // and replace placeholders like {{{COMPANY_NAME}}} with companyData.COMPANY_NAME
            const docConcept = findDocumentConcept(docId); // Helper to find doc from ohsSystemCategories
            if (docConcept) {
                const docPreview = document.createElement('div');
                docPreview.className = 'review-section'; // Use existing styling
                docPreview.innerHTML = `
                    <h4><i class="${docConcept.icon || 'fas fa-file-alt'}"></i> ${docConcept.name}</h4>
                    <p><strong>Status:</strong> Ready for generation.</p>
                    <p><em>Content for ${docConcept.name} would be shown here, populated with company details like "${companyData.COMPANY_NAME}". Full editing is a future enhancement.</em></p>
                    <textarea style="width:100%; height:100px; margin-top:5px;" placeholder="Add notes or minor edits for ${docConcept.name}..."></textarea>
                `;
                previewArea.appendChild(docPreview);
            }
        });
    }
    
    function findDocumentConcept(docId) {
        for (const catKey in ohsSystemCategories) {
            const category = ohsSystemCategories[catKey];
            if (category.documents) {
                const foundDoc = category.documents.find(d => d.id === docId);
                if (foundDoc) return foundDoc;
            }
            if (category.subcategories) {
                for (const subCatKey in category.subcategories) {
                    const subCategory = category.subcategories[subCatKey];
                    const foundDoc = subCategory.documents.find(d => d.id === docId);
                    if (foundDoc) return foundDoc;
                }
            }
        }
        return null; // Should ideally always find if docId came from selection
    }

    function populateCheckoutSection() {
        document.getElementById('final-company-name').textContent = companyData.COMPANY_NAME || 'N/A';
        document.getElementById('final-ceo-name').textContent = companyData.CEO_NAME || 'N/A';
        document.getElementById('final-compiler-name').textContent = companyData.COMPILED_BY_NAME || 'N/A';
        document.getElementById('final-compiler-role').textContent = companyData.COMPILED_BY_ROLE || 'N/A';

        const finalListEl = document.getElementById('final-document-list');
        finalListEl.innerHTML = '';
        selectedDocuments.forEach(docId => {
            const docConcept = findDocumentConcept(docId);
            if (docConcept) {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<i class="${docConcept.icon || 'fas fa-file-alt'}"></i> ${docConcept.name}`;
                finalListEl.appendChild(listItem);
            }
        });
    }

    document.getElementById('download-documents-btn')?.addEventListener('click', () => {
        showCustomMessage('Download Started', 'Your documents would begin downloading now. (This is a placeholder - actual PDF generation from LaTeX is a backend process).');
        // Here, you would ideally trigger a process to take `selectedDocuments` and `companyData`
        // and generate PDFs using the LaTeX templates. This is complex for client-side JS.
        // For now, it's a placeholder.
    });
    
    function showCustomMessage(title, message) { /* ... Omitted for brevity, same as before ... */ }

    document.querySelectorAll('#module-specific-resources-section .accordion-button').forEach(button => { /* ... Omitted for brevity, same as before ... */ });
    function setActiveToolLink() { /* ... Omitted for brevity, same as before ... */ }
    setActiveToolLink(); 

    // Initial setup
    hideAllProcessSections(); 
    // If you want to default to manual selection view, for example:
    // document.getElementById('show-manual-btn').click(); 
    // Or, simply ensure interactionChoiceSection is visible by default.
    interactionChoiceSection.style.display = 'block';
    if(moduleSpecificResourcesSection) moduleSpecificResourcesSection.style.display = 'block';


  });
</script>
</body>
</html>
