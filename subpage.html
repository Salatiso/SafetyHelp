<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SafetyHelp | Subpage Template</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* Custom Styles to match about.html and community.html aesthetics */
    body {
      font-family: 'Montserrat', sans-serif; /* Matching font */
      background-color: #E8F0FE; /* Matching background */
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      margin: 0; /* Explicitly remove default margin */
    }
    header {
      background: #007BFF; /* Blue from reference pages */
      color: #fff;
      padding: 0.8rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .logo-container { display: flex; align-items: center; color: #fff; text-decoration: none;}
    .logo { font-weight: 700; font-size: 1.75rem; letter-spacing: -0.025em; }
    .logo .help { font-weight: 900; color: #FF8C00; } /* Orange from reference pages */
    nav { display: flex; gap: 0.5rem; }
    nav a {
      color: white;
      font-weight: 500;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      transition: background-color 0.3s ease, transform 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border: 1px solid transparent;
      text-decoration: none;
    }
    nav a:hover, nav a.active-nav-link {
      background-color: rgba(255,255,255,0.15);
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.3);
    }
    nav a .nav-icon { font-size: 0.9em; }
    .search-language { display: flex; align-items: center; gap: 1rem; }
    .search-language input, .search-language select {
      padding: 0.6rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Montserrat', sans-serif;
      background-color: #fff;
      color: #333;
      font-size: 0.9rem;
    }

    .page-title-section {
      background: #F3F4F6; /* Light grey from reference pages */
      padding: 1.5rem 2rem;
      text-align: center;
      border-bottom: 1px solid #e0e0e0;
      flex-shrink: 0;
    }
    .page-title-section h1 { font-size: 2.2rem; color: #1f2937; margin-bottom: 0.5rem; }
    .page-title-section p.subtitle { font-size: 1rem; color: #374151; max-width: 800px; margin-left: auto; margin-right: auto; }

    .page-content-container {
      display: flex;
      flex-grow: 1;
      overflow: hidden;
    }
    .container-grid {
      display: grid;
      grid-template-columns: 1fr 3fr 1fr; /* Sidebar-Main-Sidebar layout */
      flex-grow: 1;
      overflow: hidden;
      min-height: 0; /* Crucial for grid item scrolling */
      gap: 1rem;
      padding: 1rem;
    }

    .sidebar-tools, .sidebar-milestones {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      overflow: hidden; /* For scrolling list */
    }
    .sidebar-heading {
      font-size: 1.2rem;
      font-weight: 700;
      color: #007BFF;
      padding: 1rem;
      border-bottom: 1px solid #e5e7eb;
      background-color: #f9f9f9;
      flex-shrink: 0;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .sidebar-heading .heading-icon { color: #FF8C00; }
    .sidebar-list-container {
        flex-grow: 1;
        overflow-y: auto; /* Enable scrolling for lists */
        position: relative;
    }
    .sidebar-tools ul, .sidebar-milestones ul { list-style: none; padding: 0; margin: 0; }
    .sidebar-tools li, .sidebar-milestones li {
      padding: 0;
      border-bottom: 1px solid #e5e7eb;
      cursor: pointer;
      display: flex;
    }
    .sidebar-tools li a, .sidebar-milestones li { /* Note: milestones li is clickable, tools li a is clickable */
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 0.9rem;
      padding: 0.85rem 1rem;
      width: 100%;
      transition: background-color 0.3s ease;
      color: #333;
      text-decoration: none;
    }
    .sidebar-tools li a:hover, .sidebar-milestones li:hover { background: #e8f0fe; }
    .sidebar-tools li a .list-icon, .sidebar-milestones li .list-icon {
        color: #007BFF;
        font-size: 1em;
        width: 20px;
        text-align: center;
    }

    .main-subpage-content {
      padding: 1.5rem;
      overflow-y: auto; /* Main content area scrolls */
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .main-subpage-content section { margin-bottom: 2.5rem; }
    .main-subpage-content h2 {
        font-size: 1.8rem;
        color: #0056b3; /* Darker blue */
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #FF8C00; /* Orange accent */
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    .main-subpage-content h2 .section-icon { color: #FF8C00; }
    .main-subpage-content p, .main-subpage-content li { font-size: 1rem; line-height: 1.7; color: #374151; margin-bottom: 1rem; }
    .main-subpage-content ul { list-style: disc; padding-left: 20px; }

    /* Legal Obligations Styling */
    .legal-obligation-item details summary {
      cursor: pointer;
      font-weight: 600;
      padding: 0.5rem;
      background-color: #f9f9f9;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      margin-bottom: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .legal-obligation-item details summary::after {
      content: '\\f078'; /* Font Awesome chevron-down */
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      transition: transform 0.2s ease-in-out;
    }
    .legal-obligation-item details[open] summary::after {
      transform: rotate(180deg);
    }
    .legal-obligation-item details div {
      padding: 1rem;
      border: 1px solid #e0e0e0;
      border-top: none;
      border-radius: 0 0 4px 4px;
      background-color: #fff;
    }
    .legal-obligation-item details div a { color: #007BFF; text-decoration: underline; }
    .legal-obligation-item details div a:hover { color: #0056b3; }

    /* Buttons */
    .action-button {
        padding: 0.75rem 1.5rem;
        border-radius: 6px;
        font-weight: 500;
        transition: background-color 0.3s ease, transform 0.2s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        text-align: center;
        cursor: pointer;
        border: none; /* Ensure no default border */
        text-decoration: none; /* For anchor tags styled as buttons */
    }
    .action-button-primary { background-color: #007BFF; color: white; }
    .action-button-primary:hover { background-color: #0056b3; transform: translateY(-2px); }
    .action-button-secondary { background-color: #FF8C00; color: white; }
    .action-button-secondary:hover { background-color: #e07b00; transform: translateY(-2px); }
    
    /* Custom CSS for interaction buttons container (replaces Tailwind flex flex-col sm:flex-row gap-4 mt-4) */
    .interaction-buttons-container {
      display: flex;
      flex-direction: column; /* Mobile first */
      gap: 1rem; 
      margin-top: 1rem; 
    }
    .interaction-buttons-container .action-button {
        flex: 1; /* Make buttons take equal width when in a row */
    }

    @media (min-width: 640px) { /* sm: breakpoint */
      .interaction-buttons-container {
        flex-direction: row;
      }
    }

    .nav-buttons { margin-top: 1.5rem; display: flex; justify-content: space-between; gap: 1rem; }
    .nav-buttons .action-button i { /* Ensure icon spacing if needed */
        /* margin-left or margin-right can be adjusted if gap on button is not enough */
    }


    /* Wizard Steps Styling */
    .wizard-step { border: 1px solid #e0e0e0; border-radius: 8px; padding: 1.5rem; margin-top: 1.5rem; background-color: #f9fafb; }
    .wizard-step h3 { font-size: 1.5rem; color: #111827; margin-bottom: 1rem; }
    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; font-weight: 500; margin-bottom: 0.25rem; color: #374151; }
    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group input[type="tel"],
    .form-group input[type="number"],
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.6rem 0.8rem;
      border: 1px solid #D1D5DB;
      border-radius: 6px;
      font-family: 'Montserrat', sans-serif;
      font-size: 0.95rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      box-sizing: border-box; /* Ensure padding doesn't expand width */
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      border-color: #007BFF;
      box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
      outline: none;
    }
     .form-group .checkbox-group label { display: inline-block; margin-right: 1rem; font-weight: normal;}

    /* Custom CSS for manual options list (replaces Tailwind grid classes) */
    .manual-options-grid {
      margin-top: 1rem; 
      display: grid;
      grid-template-columns: 1fr; /* Mobile first */
      gap: 1rem; 
    }
    .manual-options-grid .manual-option-item { /* Style for individual items in the grid */
        border: 1px solid #e0e0e0;
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: box-shadow 0.3s ease;
    }
    .manual-options-grid .manual-option-item:hover {
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .manual-options-grid .manual-option-item h4 {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        color: #0056b3;
    }
    .manual-options-grid .manual-option-item p {
        font-size: 0.9rem;
        color: #374151;
        margin-bottom: 0.75rem;
    }
    .manual-options-grid .manual-option-item .action-button {
        width: 100%; /* Make button full width of its container */
    }


    @media (min-width: 768px) { /* md: breakpoint */
      .manual-options-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (min-width: 1024px) { /* lg: breakpoint */
      .manual-options-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }


    footer {
      background: #343a40; /* Dark grey from reference pages */
      color: #adb5bd;
      text-align: center;
      padding: 1.5rem 2rem;
      font-size: 0.9rem;
      flex-shrink: 0;
      border-top: 3px solid #FF8C00; /* Orange accent */
    }
    footer p { margin-bottom: 0.5rem; }
    footer a { color: #FF8C00; transition: color 0.3s ease; text-decoration: none;}
    footer a:hover { color: #fff; }

    /* Modal Styles (from reference pages) */
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); padding-top: 60px; }
    .modal-content { background-color: #fefefe; margin: 5% auto; padding: 25px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative; }
    .modal-header { padding-bottom: 10px; border-bottom: 1px solid #eee; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
    .modal-header h4 { margin: 0; font-size: 1.4rem; color: #007BFF; }
    .close-btn { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.3s; }
    .close-btn:hover, .close-btn:focus { color: #333; text-decoration: none; }
    .modal-body p { font-size: 1rem; line-height: 1.6; margin-bottom: 1rem; }
    .modal-footer { padding-top: 15px; border-top: 1px solid #eee; margin-top: 20px; text-align: right; }
    .modal-footer button { /* Base styling covered by .action-button, specific modal footer button overrides if any */ }
    .modal-footer .action-button-secondary { /* Example if you use specific button types */
        background-color: #6c757d; /* A common close button color */
    }
    .modal-footer .action-button-secondary:hover {
        background-color: #5a6268;
    }


    /* Chatbot Styles (from reference pages) */
    .chatbot-container { position: fixed; bottom: 20px; right: 20px; z-index: 1050; }
    #chat-toggle { background-color: #FF8C00; color: white; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 1.8rem; box-shadow: 0 4px 8px rgba(0,0,0,0.2); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.3s ease, transform 0.3s ease; }
    #chat-toggle:hover { background-color: #e07b00; transform: scale(1.1); }
    #chat-window { width: 320px; max-height: 450px; background-color: #fff; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); display: flex; flex-direction: column; overflow: hidden; transition: opacity 0.3s ease, transform 0.3s ease; position: absolute; bottom: 75px; right: 0; opacity: 0; transform: translateY(10px); pointer-events: none; }
    #chat-window.chat-expanded { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .chat-hidden { display: none !important; } /* Ensure hidden is effective */
    #chat-header { background-color: #007BFF; color: white; padding: 10px 15px; font-weight: 600; border-top-left-radius: 10px; border-top-right-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
    #chat-header .close-chat-btn { background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; }
    #chat-output { flex-grow: 1; padding: 15px; overflow-y: auto; font-size: 0.9rem; background-color: #f9f9f9; }
    #chat-output p { margin-bottom: 0.8rem; line-height: 1.4; }
    #chat-output p strong { color: #007BFF; }
    #chat-output p strong:first-child { color: #FF8C00; }
    #chat-input-container { display: flex; border-top: 1px solid #eee; padding: 10px; background-color: #fff; }
    #chat-input { flex-grow: 1; padding: 0.7rem; border: 1px solid #ddd; border-radius: 6px; margin-right: 8px; font-family: 'Montserrat', sans-serif; }
    #chat-send { background-color: #007BFF; color: white; padding: 0.7rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; transition: background-color 0.3s ease; }
    #chat-send:hover { background-color: #0056b3; }

    /* Hide elements by default */
    .hidden { display: none; }

    /* Responsive adjustments (Retained from original subpage for improved UX) */
    @media (max-width: 1024px) { /* Adjust for tablets and smaller */
      .container-grid {
        grid-template-columns: 1fr; /* Stack main content and sidebars */
      }
      .sidebar-tools, .sidebar-milestones {
        max-height: 300px; /* Limit height when stacked */
        margin-bottom: 1rem;
      }
       main.main-subpage-content {
        order: -1; /* Show main content first on smaller screens */
      }
    }
    @media (max-width: 768px) { /* Adjust for mobile */
        header { flex-direction: column; gap: 0.5rem; padding: 0.8rem 1rem; }
        nav { flex-wrap: wrap; justify-content: center; gap: 0.25rem; } /* Reduced gap for smaller screens */
        nav a { padding: 0.5rem 0.8rem; } /* Slightly smaller padding for nav links */
        .search-language { width: 100%; justify-content: space-between; margin-top: 0.5rem;}
        .search-language input { flex-grow: 1; margin-right: 0.5rem; }
        .page-title-section h1 { font-size: 1.8rem; }
        .page-title-section p.subtitle { font-size: 0.9rem; }
        .main-subpage-content h2 { font-size: 1.6rem; }
        .wizard-step h3 { font-size: 1.3rem; }
        .action-button { padding: 0.6rem 1.2rem; font-size: 0.9rem;}
    }

  </style>
</head>
<body>
  <header>
    <a href="/SafetyHelp/index.html" class="logo-container">
        <div class="logo">Safety<span class="help">Help</span></div>
    </a>
    <nav>
      <a href="/SafetyHelp/index.html"><i class="fas fa-home nav-icon"></i>Home</a>
      <a href="/SafetyHelp/resources.html"><i class="fas fa-book nav-icon"></i>Resources</a>
      <a href="/SafetyHelp/services.html"><i class="fas fa-concierge-bell nav-icon"></i>Services</a>
      <a href="/SafetyHelp/community.html"><i class="fas fa-users nav-icon"></i>Community</a>
      <a href="/SafetyHelp/about.html"><i class="fas fa-info-circle nav-icon"></i>About</a>
      <a href="/SafetyHelp/contact.html"><i class="fas fa-envelope nav-icon"></i>Contact</a>
      <a href="/SafetyHelp/login.html"><i class="fas fa-sign-in-alt nav-icon"></i>SignUp / Login</a>
    </nav>
    <div class="search-language">
      <input type="text" placeholder="Search...">
      <select>
        <option>English</option>
        <option>isiXhosa</option>
        <option>Afrikaans</option>
      </select>
    </div>
  </header>

  <div class="page-title-section">
    <h1 id="subpage-title">Subpage Module Title</h1>
    <p class="subtitle" id="subpage-subtitle">A brief description of what this module offers and its importance.</p>
  </div>

  <div class="page-content-container">
    <div class="container-grid">
      <aside class="sidebar-tools">
        <h3 class="sidebar-heading"><i class="fas fa-tools heading-icon"></i>SafetyHelp Tools</h3>
        <div class="sidebar-list-container">
          <ul id="safetyhelp-tools-list">
            <li><a href="/SafetyHelp/pages/construction-compliance.html" data-detail="Comprehensive safety management for construction projects."><i class="fas fa-hard-hat list-icon"></i>Construction Safety</a></li>
            <li><a href="/SafetyHelp/pages/emergency-response-plan.html" data-detail="Develop effective emergency plans."><i class="fas fa-bell list-icon"></i>Emergency Planning</a></li>
            <li><a href="/SafetyHelp/pages/risk-assessment.html" data-detail="Identify and control workplace hazards."><i class="fas fa-shield-alt list-icon"></i>Risk Assessment</a></li>
            <li><a href="/SafetyHelp/pages/legal-appointments.html" data-detail="Manage OHS legal appointments."><i class="fas fa-gavel list-icon"></i>Legal Appointments</a></li>
            <li><a href="/SafetyHelp/pages/incident-management.html" data-detail="Report and investigate incidents."><i class="fas fa-file-medical-alt list-icon"></i>Incident Management</a></li>
            <li><a href="/SafetyHelp/pages/training.html" data-detail="Access OHS training programs."><i class="fas fa-graduation-cap list-icon"></i>Training</a></li>
            <li><a href="/SafetyHelp/pages/inspections-audits.html" data-detail="Conduct workplace inspections and audits."><i class="fas fa-clipboard-check list-icon"></i>Inspections & Audits</a></li>
            <li><a href="/SafetyHelp/pages/suppliers.html" data-detail="Manage supplier OHS compliance."><i class="fas fa-truck list-icon"></i>Suppliers</a></li>
            <li><a href="/SafetyHelp/pages/legislation.html" data-detail="Stay updated with OHS legislation."><i class="fas fa-balance-scale list-icon"></i>Legislation</a></li>
            <li><a href="/SafetyHelp/pages/community-tools.html" data-detail="Engage with the OHS community."><i class="fas fa-users list-icon"></i>Community Tools</a></li>
            <li><a href="/SafetyHelp/member-dashboard.html" data-detail="Your personalized OHS dashboard."><i class="fas fa-tachometer-alt list-icon"></i>Member Dashboard</a></li>
            <li><a href="/SafetyHelp/pages/ohs-system.html" data-detail="Build a comprehensive OHS system."><i class="fas fa-cogs list-icon"></i>OHS System Modules</a></li>
          </ul>
        </div>
      </aside>

      <main class="main-subpage-content">
        <section id="introduction-section">
          <h2><i class="fas fa-info-circle section-icon"></i>Introduction to [Module Name]</h2>
          <p>This module provides comprehensive tools and resources for [briefly explain module purpose, e.g., managing construction compliance, conducting risk assessments]. Understanding and implementing these practices is crucial for ensuring a safe and healthy work environment in line with South African OHS legislation.</p>
          <p>Here, you can learn about your legal duties, access relevant documents, and utilize our wizards to streamline your OHS processes.</p>
        </section>

        <section id="legal-obligations-section">
          <h2><i class="fas fa-balance-scale section-icon"></i>Key Legal Obligations</h2>
          <p>Below are some of the key legal obligations relevant to [Module Name]. Click on each item to expand and see more details, including legislative references and links.</p>
          <div class="legal-obligation-item">
            <details>
              <summary>Obligation 1: [Brief Title of Obligation]</summary>
              <div>
                <p><strong>Detailed Explanation:</strong> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                <p><strong>Legal Reference:</strong> Occupational Health and Safety Act, No. 85 of 1993, Section X(Y).</p>
                <p><a href="#" target="_blank" rel="noopener noreferrer">Link to relevant legislation/guideline</a></p>
              </div>
            </details>
          </div>
          <div class="legal-obligation-item">
            <details>
              <summary>Obligation 2: [Brief Title of Obligation]</summary>
              <div>
                <p><strong>Detailed Explanation:</strong> Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                <p><strong>Legal Reference:</strong> Construction Regulations, 2014, Regulation Z.</p>
                <p><a href="#" target="_blank" rel="noopener noreferrer">Link to relevant legislation/guideline</a></p>
              </div>
            </details>
          </div>
          </section>

        <section id="interaction-choice-section">
          <h2><i class="fas fa-cogs section-icon"></i>How Would You Like to Proceed?</h2>
          <p>Choose how you want to interact with the [Module Name] tools. You can use our automated wizard for a guided experience or manually select the specific documents and tools you need.</p>
          <div class="interaction-buttons-container">
            <button id="show-wizard-btn" class="action-button action-button-primary">
              <i class="fas fa-magic"></i>Automated Wizard
            </button>
            <button id="show-manual-btn" class="action-button action-button-secondary">
              <i class="fas fa-tasks"></i>Manual Selection
            </button>
          </div>
        </section>

        <section id="automated-wizard-section" class="hidden">
          <h2><i class="fas fa-magic section-icon"></i>Automated Wizard: [Module Name]</h2>
          <p>Follow the steps below to generate your [Module Name] documents and plans.</p>

          <div id="wizard-step-1" class="wizard-step">
            <h3>Step 1: Select Your Role</h3>
            <div class="form-group">
              <label for="user-role">Your Role:</label>
              <select id="user-role" name="user-role">
                <option value="">-- Select Role --</option>
                <option value="client">Client</option>
                <option value="contractor">Contractor</option>
                <option value="employer">Employer</option>
                <option value="employee">Employee</option>
                <option value="ohs_professional">OHS Professional</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="nav-buttons">
              <button class="action-button action-button-primary wizard-next-btn">Next <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>

          <div id="wizard-step-2" class="wizard-step hidden">
            <h3>Step 2: Your Details</h3>
            <div class="form-group"><label for="user-name">Full Name:</label><input type="text" id="user-name" name="user-name"></div>
            <div class="form-group"><label for="user-email">Email:</label><input type="email" id="user-email" name="user-email"></div>
            <div class="form-group"><label for="user-phone">Phone Number:</label><input type="tel" id="user-phone" name="user-phone"></div>
            <div class="nav-buttons">
              <button class="action-button action-button-secondary wizard-prev-btn"><i class="fas fa-arrow-left"></i>Back</button>
              <button class="action-button action-button-primary wizard-next-btn">Next <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>

          <div id="wizard-step-3" class="wizard-step hidden">
            <h3>Step 3: Site/Project Details</h3>
             <div class="form-group"><label for="project-name">Project Name:</label><input type="text" id="project-name" name="project-name"></div>
            <div class="form-group"><label for="site-location">Site Location/Address:</label><input type="text" id="site-location" name="site-location"></div>
            <div class="nav-buttons">
                <button class="action-button action-button-secondary wizard-prev-btn"><i class="fas fa-arrow-left"></i>Back</button>
                <button class="action-button action-button-primary wizard-next-btn">Next <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>

          <div id="wizard-step-4" class="wizard-step hidden">
            <h3>Step 4: Select Documents/Actions</h3>
            <p id="role-specific-options-placeholder">Based on your role as a [Selected Role], you can compile the following: (This content will be dynamic based on role and module).</p>
            <div id="client-options" class="hidden">
              <h4>Client Options:</h4>
              <div class="form-group checkbox-group">
                <input type="checkbox" id="compile-ohs-specs" name="client_docs" value="ohs_specs"><label for="compile-ohs-specs">Compile OHS Specifications</label><br>
                <input type="checkbox" id="compile-baseline-risk" name="client_docs" value="baseline_risk"><label for="compile-baseline-risk">Compile Baseline Risk Assessment</label><br>
                <input type="checkbox" id="compile-notification-work" name="client_docs" value="notification_work"><label for="compile-notification-work">Compile Notification of Construction Work</label><br>
                <input type="checkbox" id="compile-mandatory-agreement" name="client_docs" value="mandatory_agreement"><label for="compile-mandatory-agreement">Compile Mandatory Agreement (Section 37(2))</label><br>
                <input type="checkbox" id="compile-contractor-appointment" name="client_docs" value="contractor_appointment"><label for="compile-contractor-appointment">Compile Contractor Appointment Letter</label><br>
              </div>
            </div>
             <div id="contractor-options" class="hidden">
              <h4>Contractor Options:</h4>
              <div class="form-group checkbox-group">
                <input type="checkbox" id="compile-hs-plan" name="contractor_docs" value="hs_plan"><label for="compile-hs-plan">Compile Health & Safety Plan</label><br>
                <input type="checkbox" id="compile-hs-file" name="contractor_docs" value="hs_file"><label for="compile-hs-file">Compile Health & Safety File</label><br>
                <input type="checkbox" id="compile-subcontractor-specs" name="contractor_docs" value="subcontractor_specs"><label for="compile-subcontractor-specs">Compile Specifications for Subcontractors</label><br>
              </div>
            </div>
            <div class="form-group" style="margin-top: 1rem;"> <label for="compiling-for">Compiling for:</label>
                <select id="compiling-for" name="compiling-for">
                    <option value="self">Myself / My Company</option>
                    <option value="another">Another Party</option>
                </select>
            </div>
            <div id="another-party-details" class="form-group hidden" style="margin-top: 0.5rem;"> <label for="another-party-name">Other Party's Name/Company:</label>
                <input type="text" id="another-party-name" name="another-party-name">
            </div>
            <div class="nav-buttons">
                <button class="action-button action-button-secondary wizard-prev-btn"><i class="fas fa-arrow-left"></i>Back</button>
                <button class="action-button action-button-primary wizard-next-btn">Next <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>

          <div id="wizard-step-5" class="wizard-step hidden">
            <h3>Step 5: Provide Information for Selected Documents</h3>
            <p id="document-fields-placeholder">Please fill in the required details for the documents you've selected. (This section will dynamically show forms based on selections).</p>
            <div class="nav-buttons">
                <button class="action-button action-button-secondary wizard-prev-btn"><i class="fas fa-arrow-left"></i>Back</button>
                <button class="action-button action-button-primary wizard-next-btn">Next <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>

          <div id="wizard-step-6" class="wizard-step hidden">
            <h3>Step 6: Review Your Document(s)</h3>
            <p id="document-preview-placeholder">Here's a preview of your generated document(s). Please review carefully. (This will show a summary or a link to a preview).</p>
            <div class="nav-buttons">
                <button class="action-button action-button-secondary wizard-prev-btn"><i class="fas fa-arrow-left"></i>Back</button>
                <button class="action-button action-button-primary wizard-next-btn">Next <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>

          <div id="wizard-step-7" class="wizard-step hidden">
            <h3>Step 7: Final Compilation Details</h3>
             <div class="form-group">
                <label for="confirm-compiling-for-name">Confirm who this document is for:</label>
                <input type="text" id="confirm-compiling-for-name" name="confirm-compiling-for-name" placeholder="Name of person/company document is for">
            </div>
            <div class="form-group">
                <label for="chso-agent-name">Certified CHSO/Agent Name (if applicable):</label>
                <input type="text" id="chso-agent-name" name="chso-agent-name">
            </div>
            <div class="form-group">
                <label for="chso-agent-reg">CHSO/Agent Registration Number:</label>
                <input type="text" id="chso-agent-reg" name="chso-agent-reg">
            </div>
            <div class="nav-buttons">
                <button class="action-button action-button-secondary wizard-prev-btn"><i class="fas fa-arrow-left"></i>Back</button>
                <button class="action-button action-button-primary wizard-next-btn">Proceed to Checkout <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>

          <div id="wizard-step-8" class="wizard-step hidden">
            <h3>Step 8: Checkout & Document Generation</h3>
            <p>Your documents are ready for generation. Please proceed to checkout.</p>
            <button id="generate-document-btn" class="action-button action-button-primary" style="margin-top: 1rem;"><i class="fas fa-file-pdf"></i>Generate Document(s)</button>
            <div class="nav-buttons">
                <button class="action-button action-button-secondary wizard-prev-btn"><i class="fas fa-arrow-left"></i>Back</button>
            </div>
          </div>
        </section>

        <section id="manual-selection-section" class="hidden">
          <h2><i class="fas fa-tasks section-icon"></i>Manual Selection: [Module Name]</h2>
          <p>Select the specific documents or tools you need for [Module Name].</p>
          <div id="manual-options-list" class="manual-options-grid">
            <div class="manual-option-item">
              <h4>Compile OHS Plan</h4>
              <p>Manually create a detailed Occupational Health and Safety Plan for your project.</p>
              <button class="action-button action-button-secondary manual-select-item-btn" data-item="ohs_plan">Select</button>
            </div>
            <div class="manual-option-item">
              <h4>Compile Baseline Risk Assessment</h4>
              <p>Develop a comprehensive baseline risk assessment for your site.</p>
              <button class="action-button action-button-secondary manual-select-item-btn" data-item="baseline_risk_assessment">Select</button>
            </div>
             </div>

          <div id="manual-item-form-section" class="wizard-step hidden" style="margin-top: 1.5rem;"> <h3 id="manual-item-title">Provide Details for [Selected Item]</h3>
            <div id="manual-item-form-placeholder">
                <p>Please fill in the required details for the selected document/tool.</p>
            </div>
            <div class="form-group">
                <label for="manual-compiling-for">Compiling for:</label>
                <select id="manual-compiling-for" name="manual-compiling-for">
                    <option value="self">Myself / My Company</option>
                    <option value="another">Another Party</option>
                </select>
            </div>
            <div id="manual-another-party-details" class="form-group hidden" style="margin-top: 0.5rem;"> <label for="manual-another-party-name">Other Party's Name/Company:</label>
                <input type="text" id="manual-another-party-name" name="manual-another-party-name">
            </div>
             <div class="form-group">
                <label for="manual-chso-agent-name">Certified CHSO/Agent Name (if applicable):</label>
                <input type="text" id="manual-chso-agent-name" name="manual-chso-agent-name">
            </div>
            <div class="form-group">
                <label for="manual-chso-agent-reg">CHSO/Agent Registration Number:</label>
                <input type="text" id="manual-chso-agent-reg" name="manual-chso-agent-reg">
            </div>
            <div class="nav-buttons">
                <button id="manual-form-back-btn" class="action-button action-button-secondary"><i class="fas fa-arrow-left"></i>Back to Options</button>
                <button id="manual-generate-document-btn" class="action-button action-button-primary">Generate Document <i class="fas fa-file-alt"></i></button>
            </div>
          </div>
        </section>

      </main>

      <aside class="sidebar-milestones">
        <h3 class="sidebar-heading"><i class="fas fa-flag-checkered heading-icon"></i>OHS Milestones</h3>
        <div class="sidebar-list-container">
          <ul id="ohs-milestones-list">
<li data-detail="Ancient Egyptians used linen strips to bind wounds, an early form of first aid, reflecting basic safety practices. <a href='https://www.history.com/topics/ancient-egypt' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>3000 BC: Early First Aid (Egypt)</li>
          <li data-detail="Hippocrates documented lead poisoning effects, marking an early recognition of occupational health hazards. <a href='https://www.britannica.com/biography/Hippocrates' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>400 BC: Lead Poisoning (Greece)</li>
          <li data-detail="Pliny the Elder recommended masks for workers exposed to dust, an early OHS intervention. <a href='https://www.britannica.com/biography/Pliny-the-Elder' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>50 AD: Protective Masks (Rome)</li>
          <li data-detail="Khoisan people in South Africa used herbal remedies for injuries, laying foundations for traditional safety practices. <a href='https://www.sahistory.org.za/article/khoisan' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1000 AD: Khoisan Healing (SA)</li>
          <li data-detail="Bantu-speaking peoples developed mining techniques, facing risks like cave-ins, early occupational hazards in SA. <a href='https://www.sahistory.org.za/article/bantu-migration' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1200 AD: Early Mining (SA)</li>
          <li data-detail="The Industrial Revolution increased workplace hazards globally, influencing later OHS developments in SA. <a href='https://www.britannica.com/event/Industrial-Revolution' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1760: Industrial Revolution (Global)</li>
          <li data-detail="UK's Health and Morals of Apprentices Act protected workers, setting a precedent for colonial SA laws. <a href='https://www.parliament.uk/about/living-heritage/transformingsociety/livinglearning/19thcentury' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1802: Apprentices Act (UK)</li>
          <li data-detail="UK Factories Act regulated factory conditions, influencing colonial safety standards in SA. <a href='https://www.bl.uk/collection-items/factory-act-1833' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1833: Factories Act (UK)</li>
          <li data-detail="Gold discovery in SA led to mining towns, increasing occupational risks and need for safety measures. <a href='https://www.sahistory.org.za/article/discovery-gold-1886' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1886: Gold Discovery (SA)</li>
          <li data-detail="SA Mines and Works Act regulated mining safety under colonial rule, addressing rising hazards. <a href='https://www.gov.za/documents/mines-and-works-act' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1911: Mines and Works Act (SA)</li>
          <li data-detail="ILO founded, promoting global workers' safety rights, influencing SA policies post-Union. <a href='https://www.ilo.org/global/about-the-ilo/history' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1919: ILO Founded (Global)</li>
          <li data-detail="SA Workmen's Compensation Act provided injury compensation, a key OHS advancement. <a href='https://www.gov.za/documents/workmens-compensation-act' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1941: Workmen's Compensation (SA)</li>
          <li data-detail="UK Factories Act update set new safety standards, impacting SA's colonial framework. <a href='https://www.legislation.gov.uk/ukpga/Geo6/11-12/55/contents' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1948: Factories Act Update (UK)</li>
          <li data-detail="WHO established, promoting global health and safety, influencing SA's post-apartheid policies. <a href='https://www.who.int/about/history' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1948: WHO Founded (Global)</li>
          <li data-detail="First OHS training programs introduced in SA mines, enhancing worker safety awareness. <a href='https://www.saimm.co.za/history' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1950: OHS Training (SA)</li>
          <li data-detail="Safety audits began in SA mines, formalizing risk management practices. <a href='https://www.mhsc.org.za/about-us/history' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1960: Safety Audits (SA)</li>
          <li data-detail="US OSHA Act set workplace safety standards, influencing SA's later OHS laws. <a href='https://www.osha.gov/laws-regs/oshact/completeoshact' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1970: OSHA (USA)</li>
          <li data-detail="Global ergonomic standards emerged, later adopted in SA for workplace design. <a href='https://www.ergonomics.org/history' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1970: Ergonomics (Global)</li>
          <li data-detail="UK Health and Safety at Work Act influenced SA's modern OHS framework. <a href='https://www.legislation.gov.uk/ukpga/1974/37/contents' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1974: HSWA (UK)</li>
          <li data-detail="SA hosted first OHS conferences, fostering local safety knowledge exchange. <a href='https://www.iosh.com/about-us/our-history' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1980: OHS Conferences (SA)</li>
          <li data-detail="Bhopal disaster highlighted chemical safety needs, prompting SA regulations. <a href='https://www.britannica.com/event/Bhopal-disaster' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1984: Bhopal Disaster (India)</li>
          <li data-detail="Chernobyl accident emphasized high-risk industry safety, impacting SA mining. <a href='https://www.world-nuclear.org/information-library/safety-and-security/safety-of-plants/chernobyl-accident.aspx' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1986: Chernobyl (USSR)</li>
          <li data-detail="Piper Alpha disaster led to offshore safety reforms, influencing SA's oil sector. <a href='https://www.hse.gov.uk/offshore/piper-alpha-disaster.htm' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1988: Piper Alpha (UK)</li>
          <li data-detail="First OHS software tools developed globally, adopted later in SA for risk assessment. <a href='https://www.ehstoday.com/safety-technology/article/21917342/the-evolution-of-safety-technology' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1990: OHS Software (Global)</li>
          <li data-detail="SA OHS Act No. 85 of 1993 established modern safety responsibilities post-apartheid. <a href='https://www.gov.za/documents/occupational-health-and-safety-act' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1993: OHS Act (SA)</li>
          <li data-detail="SA COIDA amended, improving worker compensation and rehabilitation processes. <a href='https://www.gov.za/documents/compensation-occupational-injuries-and-diseases-act' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2003: COIDA Amendment (SA)</li>
          <li data-detail="First mobile OHS apps emerged globally, enhancing SA's safety management. <a href='https://www.safetyandhealthmagazine.com/articles/18647-safety-apps' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2010: OHS Mobile Apps (Global)</li>
          <li data-detail="SA Construction Regulations updated, improving site safety standards. <a href='https://www.labour.gov.za/DocumentCenter/Regulations%202014/Construction%20Regulations%202014.pdf' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2014: Construction Regs (SA)</li>
          <li data-detail="GHS adopted globally for chemical safety, implemented in SA industries. <a href='https://www.unece.org/trans/danger/publi/ghs/ghs_welcome.html' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2015: Global Harmonization (GHS)</li>
          <li data-detail="VR training programs introduced globally, later used in SA for safety education. <a href='https://www.osha.gov/virtual-reality' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2015: VR Training (Global)</li>
          <li data-detail="COVID-19 protocols introduced worldwide, reshaping SA workplace safety. <a href='https://www.who.int/emergencies/diseases/novel-coronavirus-2019' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2020: COVID-19 Protocols</li>
          <li data-detail="SA deployed AI-powered safety monitoring in mines, advancing risk prevention. <a href='https://www.miningreview.com/technology/ai-in-mining-safety/' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2020: AI Safety Monitoring (SA)</li>
          <li data-detail="Global focus on workplace mental health recognized in SA OHS policies. <a href='https://www.who.int/news-room/fact-sheets/detail/mental-health-at-work' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2022: Mental Health Focus</li>
          <li data-detail="Blockchain introduced for OHS records globally, adopted in SA for transparency. <a href='https://www.osha.gov/blockchain' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2022: Blockchain OHS (Global)</li>
          <li data-detail="SA mines used drones for safety inspections, improving hazard detection. <a href='https://www.mining-technology.com/features/drones-in-mining/' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2023: Drone Inspections (SA)</li>
          <li data-detail="5G enabled real-time safety monitoring globally, adopted in SA industries. <a href='https://www.safetyandhealthmagazine.com/articles/5g-safety' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2024: 5G Safety Monitoring (Global)</li>
          <li data-detail="Safety helmets introduced globally, widely used in SA construction. <a href='https://www.constructiondive.com/news/history-of-hard-hats/557118/' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1930: Safety Helmets (Global)</li>
          <li data-detail="Steel-toe safety shoes developed globally, adopted in SA mining. <a href='https://www.ishn.com/articles/105586-the-evolution-of-safety-footwear' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1940: Safety Shoes (Global)</li>
          <li data-detail="First aid formalized globally, influencing SA workplace emergency practices. <a href='https://www.redcross.org/about-us/who-we-are/history.html' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1863: First Aid (Global)</li>
          <li data-detail="Dust masks introduced globally, used in SA mines to reduce respiratory risks. <a href='https://www.cdc.gov/niosh/topics/respirators/history.html' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1900: Dust Masks (Global)</li>
          <li data-detail="SA mining regulations tightened post-apartheid, focusing on worker safety. <a href='https://www.mhsc.org.za/legislation' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>1996: Mining Safety (SA)</li>
          <li data-detail="SA introduced silica dust controls in mines, addressing health hazards. <a href='https://www.saimm.co.za/Journal/v115n10p885.pdf' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2000: Silica Dust Control (SA)</li>
          <li data-detail="SA adopted international noise control standards in workplaces. <a href='https://www.labourguide.co.za/noise-induced-hearing-loss' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2005: Noise Control (SA)</li>
          <li data-detail="Global push for green safety practices influenced SA's sustainability focus. <a href='https://www.un.org/sustainabledevelopment/' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2010: Green Safety (Global)</li>
          <li data-detail="SA implemented fatigue management in transport and mining sectors. <a href='https://www.rtms-sa.org/fatigue-management' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2015: Fatigue Management (SA)</li>
          <li data-detail="Wearable safety tech emerged globally, used in SA for worker monitoring. <a href='https://www.safetyandhealthmagazine.com/articles/wearable-technology' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2018: Wearable Tech (Global)</li>
          <li data-detail="SA enhanced construction crane safety regulations after incidents. <a href='https://www.labour.gov.za/construction-safety' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2019: Crane Safety (SA)</li>
          <li data-detail="Quantum computing explored for OHS risk modeling, future potential for SA. <a href='https://www.nature.com/articles/s41586-021-03398-4' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2025: Quantum OHS (Global)</li>
          <li data-detail="SA planned national OHS digital platform, aligning with SafetyHelp goals. <a href='https://www.gov.za/speeches/ohs-digitalisation' target='_blank'>Source</a>"><i class="fas fa-landmark list-icon"></i>2025: OHS Digital Plan (SA)</li>
            </ul>
        </div>
      </aside>
    </div>
  </div>

  <footer>
    <p>&copy; <span id="copyright-year"></span> SafetyHelp. All rights reserved. Your Partner in Occupational Health and Safety Compliance.</p>
    <p><a href="/SafetyHelp/privacy.html">Privacy Policy</a> | <a href="/SafetyHelp/terms.html">Terms of Service</a> | <a href="/SafetyHelp/contact.html">Contact Us</a></p>
  </footer>

  <div id="infoModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h4 id="modalTitle">Milestone Detail</h4>
        <span class="close-btn" onclick="closeModal()">&times;</span>
      </div>
      <div class="modal-body" id="modalBody"></div>
      <div class="modal-footer">
        <button onclick="closeModal()" class="action-button action-button-secondary"><i class="fas fa-times"></i>Close</button>
      </div>
    </div>
  </div>

  <div class="chatbot-container">
      <div id="chat-window" class="chat-hidden">
          <div id="chat-header">
              <span>Salatiso - Your OHS Assistant</span>
              <button class="close-chat-btn" onclick="toggleChatbot(false)">&times;</button>
          </div>
          <div id="chat-output">
              <p><strong>Salatiso:</strong> Hello! How can I help you with OHS today?</p>
          </div>
          <div id="chat-input-container">
              <input id="chat-input" type="text" placeholder="Ask about OHS...">
              <button id="chat-send"><i class="fas fa-paper-plane"></i></button>
          </div>
      </div>
      <button id="chat-toggle" onclick="toggleChatbot()">
          <i class="fas fa-headset"></i>
      </button>
  </div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Set current year in footer
    const copyrightYearEl = document.getElementById('copyright-year');
    if (copyrightYearEl) {
        copyrightYearEl.textContent = new Date().getFullYear();
    }
    

    // --- Sidebar Milestone Modal Functionality ---
    const modal = document.getElementById('infoModal');
    const modalTitleEl = document.getElementById('modalTitle');
    const modalBodyEl = document.getElementById('modalBody');

    document.querySelectorAll('#ohs-milestones-list li').forEach(item => {
      item.addEventListener('click', () => {
        const title = item.textContent.trim().replace(/^.*? /, ''); // Get text after icon
        const detail = item.dataset.detail || "More information about this milestone will be available soon.";
        if (modalTitleEl) modalTitleEl.textContent = `OHS Milestone: ${title}`;
        if (modalBodyEl) modalBodyEl.innerHTML = `<p>${detail.replace(/<a href=/g, '<a target="_blank" rel="noopener noreferrer" href=')}</p>`; // Ensure links open in new tab
        if (modal) modal.style.display = 'block';
      });
    });

    // It's good practice to have only one global closeModal function
    window.closeModal = function() {
      if (modal) modal.style.display = 'none';
    }
    // Close modal if user clicks outside of it
    window.onclick = function(event) {
      if (event.target == modal) {
        closeModal();
      }
    }

    // --- Chatbot Functionality ---
    const chatWindow = document.getElementById('chat-window');
    const chatToggleBtn = document.getElementById('chat-toggle');
    const chatInputEl = document.getElementById('chat-input');
    const chatSendBtn = document.getElementById('chat-send');
    const chatOutputEl = document.getElementById('chat-output');
    let chatbotIsVisible = false; // To track chatbot state

    window.toggleChatbot = function(forceState) { // forceState can be true (open), false (close)
      if (!chatWindow || !chatToggleBtn) return;
      
      const shouldOpen = forceState !== undefined ? forceState : !chatbotIsVisible;

      if (shouldOpen) {
          chatWindow.classList.remove('chat-hidden');
          chatWindow.classList.add('chat-expanded');
          chatToggleBtn.innerHTML = '<i class="fas fa-times"></i>';
          if (chatInputEl) chatInputEl.focus();
          chatbotIsVisible = true;
      } else {
          chatWindow.classList.add('chat-hidden');
          chatWindow.classList.remove('chat-expanded');
          chatToggleBtn.innerHTML = '<i class="fas fa-headset"></i>';
          chatbotIsVisible = false;
      }
    }

    function addChatMessageToUI(sender, message, isUser) {
        if (!chatOutputEl) return;
        const messageEl = document.createElement('p');
        messageEl.innerHTML = `<strong>${sender}:</strong> ${message}`;
        if(isUser) {
            messageEl.style.textAlign = "right"; 
            messageEl.style.color = "#333"; // User message color
        } else {
            messageEl.style.color = "#0056b3"; // Bot message color
        }
        chatOutputEl.appendChild(messageEl);
        chatOutputEl.scrollTop = chatOutputEl.scrollHeight; // Scroll to bottom
    }

    async function handleChatSend() {
        if (!chatInputEl || !chatOutputEl) return;
        const message = chatInputEl.value.trim();
        if (!message) return;

        addChatMessageToUI("You", message, true);
        chatInputEl.value = '';

        // Placeholder bot response
        let botResponse = "I'm processing your request... For complex queries, please refer to our detailed resources or contact support.";
        if (message.toLowerCase().includes("hello") || message.toLowerCase().includes("hi")) {
            botResponse = "Hello there! How can I assist you with your OHS needs today?";
        } else if (message.toLowerCase().includes("construction compliance")) {
            botResponse = "For Construction Compliance, you can use our automated wizard or manual selection tools. What specific document are you looking for? You can find these options in the main content area.";
        } else if (message.toLowerCase().includes("risk assessment")) {
            botResponse = "Our Risk Assessment tool can be found in the 'SafetyHelp Tools' sidebar, or you can use the wizard on this page if it's related to the current module.";
        }
        
        setTimeout(() => { // Simulate API call delay
            addChatMessageToUI("Salatiso", botResponse, false);
        }, 500 + Math.random() * 500);
    }

    if (chatSendBtn) chatSendBtn.addEventListener('click', handleChatSend);
    if (chatInputEl) {
      chatInputEl.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
              handleChatSend();
          }
      });
    }
    // Ensure chat is hidden initially by calling toggleChatbot(false) or relying on CSS
    if (chatWindow) {
        chatWindow.classList.add('chat-hidden'); // Ensure it's hidden by default
        chatWindow.classList.remove('chat-expanded');
    }
    if (chatToggleBtn) {
        chatToggleBtn.innerHTML = '<i class="fas fa-headset"></i>';
    }


    // --- Subpage Specific Logic ---
    const showWizardBtn = document.getElementById('show-wizard-btn');
    const showManualBtn = document.getElementById('show-manual-btn');
    const automatedWizardSection = document.getElementById('automated-wizard-section');
    const manualSelectionSection = document.getElementById('manual-selection-section');
    const interactionChoiceSection = document.getElementById('interaction-choice-section');

    const wizardSteps = document.querySelectorAll('.wizard-step');
    let currentWizardStep = 0;

    function showWizardStep(stepIndex) {
        wizardSteps.forEach((step, index) => {
            step.classList.toggle('hidden', index !== stepIndex);
        });
        currentWizardStep = stepIndex;
        
        if (stepIndex === 3) { // Step 4: Module-Specific Options (index 3)
            const userRoleSelect = document.getElementById('user-role');
            const clientOptionsDiv = document.getElementById('client-options');
            const contractorOptionsDiv = document.getElementById('contractor-options');
            const rolePlaceholder = document.getElementById('role-specific-options-placeholder');

            if (userRoleSelect && clientOptionsDiv && contractorOptionsDiv) {
                const userRole = userRoleSelect.value;
                clientOptionsDiv.classList.toggle('hidden', userRole !== 'client');
                contractorOptionsDiv.classList.toggle('hidden', userRole !== 'contractor');
                // Add more conditions for other roles if necessary
                if(rolePlaceholder) {
                    rolePlaceholder.textContent = `Based on your role as a ${userRole ? userRole.charAt(0).toUpperCase() + userRole.slice(1) : 'selected role'}, you can compile the following:`;
                }
            }
        }
    }

    if (showWizardBtn) {
      showWizardBtn.addEventListener('click', () => {
        if (automatedWizardSection) automatedWizardSection.classList.remove('hidden');
        if (manualSelectionSection) manualSelectionSection.classList.add('hidden');
        if (interactionChoiceSection) interactionChoiceSection.classList.add('hidden');
        showWizardStep(0); // Show first step of wizard
      });
    }

    if (showManualBtn) {
      showManualBtn.addEventListener('click', () => {
        if (manualSelectionSection) manualSelectionSection.classList.remove('hidden');
        if (automatedWizardSection) automatedWizardSection.classList.add('hidden');
        if (interactionChoiceSection) interactionChoiceSection.classList.add('hidden');
        
        const manualItemFormSect = document.getElementById('manual-item-form-section');
        const manualOptsList = document.getElementById('manual-options-list');
        if(manualItemFormSect) manualItemFormSect.classList.add('hidden');
        if(manualOptsList) manualOptsList.classList.remove('hidden');

      });
    }

    // Wizard Navigation
    document.querySelectorAll('.wizard-next-btn').forEach(button => {
      button.addEventListener('click', () => {
        // Add validation logic here for currentWizardStep if needed
        if (currentWizardStep < wizardSteps.length - 1) {
          showWizardStep(currentWizardStep + 1);
        }
      });
    });

    document.querySelectorAll('.wizard-prev-btn').forEach(button => {
      button.addEventListener('click', () => {
        if (currentWizardStep > 0) {
          showWizardStep(currentWizardStep - 1);
        } else { 
            if (automatedWizardSection) automatedWizardSection.classList.add('hidden');
            if (interactionChoiceSection) interactionChoiceSection.classList.remove('hidden');
        }
      });
    });
    
    const compilingForSelect = document.getElementById('compiling-for');
    const anotherPartyDetailsDiv = document.getElementById('another-party-details');
    if(compilingForSelect && anotherPartyDetailsDiv) {
        compilingForSelect.addEventListener('change', function() {
            anotherPartyDetailsDiv.classList.toggle('hidden', this.value !== 'another');
        });
    }

    const manualCompilingForSelect = document.getElementById('manual-compiling-for');
    const manualAnotherPartyDetailsDiv = document.getElementById('manual-another-party-details');
     if(manualCompilingForSelect && manualAnotherPartyDetailsDiv) {
        manualCompilingForSelect.addEventListener('change', function() {
            manualAnotherPartyDetailsDiv.classList.toggle('hidden', this.value !== 'another');
        });
    }

    const manualItemFormSection = document.getElementById('manual-item-form-section');
    const manualItemTitle = document.getElementById('manual-item-title');
    const manualOptionsList = document.getElementById('manual-options-list');
    const manualItemFormPlaceholder = document.getElementById('manual-item-form-placeholder');


    document.querySelectorAll('.manual-select-item-btn').forEach(button => {
        button.addEventListener('click', function() {
            const itemContainer = this.closest('.manual-option-item');
            if (!itemContainer) return;
            const itemNameEl = itemContainer.querySelector('h4');
            const itemName = itemNameEl ? itemNameEl.textContent : "Selected Item";
            
            if (manualItemTitle) manualItemTitle.textContent = `Provide Details for ${itemName}`;
            
            if (manualItemFormPlaceholder) { // Example dynamic form fields
                 manualItemFormPlaceholder.innerHTML = `
                    <div class="form-group"><label for="manual-project-name">Project Name:</label><input type="text" id="manual-project-name" name="manual-project-name"></div>
                    <div class="form-group"><label for="manual-site-details">Site Details:</label><textarea id="manual-site-details" name="manual-site-details" rows="3"></textarea></div>
                    <p><em>More fields specific to "${itemName}" would appear here.</em></p>
                    `;
            }
            if (manualItemFormSection) manualItemFormSection.classList.remove('hidden');
            if (manualOptionsList) manualOptionsList.classList.add('hidden');
        });
    });

    const manualFormBackBtn = document.getElementById('manual-form-back-btn');
    if (manualFormBackBtn) {
        manualFormBackBtn.addEventListener('click', () => {
            if (manualItemFormSection) manualItemFormSection.classList.add('hidden');
            if (manualOptionsList) manualOptionsList.classList.remove('hidden');
        });
    }
    
    // Placeholder for Generate Document buttons - using a custom modal-like message
    function showCustomMessage(title, message) {
        const existingModal = document.getElementById('customMessageModal');
        if (existingModal) existingModal.remove();

        const msgModal = document.createElement('div');
        msgModal.id = 'customMessageModal';
        msgModal.style.cssText = 'display: block; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); padding-top: 100px;';
        
        const msgModalContent = document.createElement('div');
        msgModalContent.style.cssText = 'background-color: #fff; margin: auto; padding: 20px; border-radius: 8px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2);';
        
        const msgModalHeader = document.createElement('h4');
        msgModalHeader.textContent = title;
        msgModalHeader.style.cssText = 'margin-top: 0; margin-bottom: 15px; font-size: 1.2rem; color: #007BFF;';
        
        const msgModalBody = document.createElement('p');
        msgModalBody.textContent = message;
        msgModalBody.style.marginBottom = '20px';

        const closeMsgBtn = document.createElement('button');
        closeMsgBtn.textContent = 'OK';
        closeMsgBtn.className = 'action-button action-button-primary'; // Use existing button style
        closeMsgBtn.onclick = function() {
            msgModal.style.display = 'none';
            msgModal.remove();
        };
        
        msgModalContent.appendChild(msgModalHeader);
        msgModalContent.appendChild(msgModalBody);
        msgModalContent.appendChild(closeMsgBtn);
        msgModal.appendChild(msgModalContent);
        document.body.appendChild(msgModal);
    }


    const generateDocBtnWizard = document.getElementById('generate-document-btn');
    if(generateDocBtnWizard) {
        generateDocBtnWizard.addEventListener('click', () => {
            showCustomMessage('Wizard Action', 'Wizard Document Generation Initiated (Placeholder)! Data would be collected and processed here.');
        });
    }
    const generateDocBtnManual = document.getElementById('manual-generate-document-btn');
    if(generateDocBtnManual) {
        generateDocBtnManual.addEventListener('click', () => {
            showCustomMessage('Manual Action', 'Manual Document Generation Initiated (Placeholder)! Data from the manual form would be processed here.');
        });
    }

  });
</script>
</body>
</html>
