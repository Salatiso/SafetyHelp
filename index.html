<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SafetyHelp offers innovative OHS tools and resources to ensure workplace and community safety in South Africa.">
    <meta name="keywords" content="OHS, occupational health and safety, safety tools, risk assessment, safety compliance, South Africa, SafetyHelp">
    <meta name="author" content="SafetyHelp Team">
    <title>SafetyHelp - Your Partner in OHS Excellence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://unpkg.com/i18next@23.15.2/dist/umd/i18next.min.js"></script>
    <script src="https://unpkg.com/i18next-browser-languagedetector@8.0.0/dist/i18nextBrowserLanguageDetector.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F0F4F8; /* Light blue-grey background */
            color: #1E293B; /* Dark slate text */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin:0;
        }

        /* Branding Colors (approximated from SHDesign.jpg) */
        :root {
            --sh-primary-dark: #0D47A1; /* Darker Blue for header/footer */
            --sh-primary-blue: #1976D2; /* Main Blue */
            --sh-secondary-orange: #FF8F00; /* Orange accent */
            --sh-secondary-yellow: #FFCA28; /* Yellow accent */
            --sh-light-bg: #FFFFFF; /* White for content cards */
            --sh-light-blue-bg: #E3F2FD; /* Light blue for some sections */
            --sh-light-yellow-bg: #FFF9C4; /* Light yellow for tip/quiz */
            --sh-text-dark: #1E293B;
            --sh-text-light: #FFFFFF;
            --sh-text-muted: #64748B;
        }

        header {
            background-color: var(--sh-primary-dark);
            color: var(--sh-text-light);
            position: sticky; /* Sticky header */
            top: 0;
            z-index: 50;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-nav-item {
            padding: 0.75rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            text-align: center;
        }
        .header-nav-item:hover {
            background-color: var(--sh-primary-blue);
            color: var(--sh-text-light);
        }
        .header-nav-item.active {
            background-color: var(--sh-secondary-orange);
            color: var(--sh-text-light);
            font-weight: 600;
        }
        .logo-img {
            height: 50px; /* Adjust as needed */
            width: auto;
        }

        .main-container-wrapper {
            display: flex;
            flex-grow: 1;
            overflow: hidden; /* Prevent overall page scroll if sidebars are too long */
        }

        #left-sidebar, #right-sidebar {
            background-color: #F8FAFC; /* Off-white */
            padding: 1.5rem; /* p-6 */
            height: calc(100vh - 80px - 68px); /* Viewport height - header - footer approx heights */
            overflow-y: auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }
        #left-sidebar {
            width: 20%; /* Adjust as needed */
            border-right: 1px solid #E2E8F0; /* Slate-200 */
        }
        #right-sidebar {
            width: 20%; /* Adjust as needed */
            border-left: 1px solid #E2E8F0; /* Slate-200 */
        }
        .sidebar-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.125rem; /* text-lg */
            font-weight: 700;
            color: var(--sh-primary-blue);
            padding: 0.75rem;
            background-color: var(--sh-light-blue-bg);
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        .sidebar-link {
            display: block;
            padding: 0.5rem 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 0.375rem;
            color: var(--sh-text-dark);
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .sidebar-link:hover, .sidebar-link.active {
            background-color: var(--sh-primary-blue);
            color: var(--sh-text-light);
        }
        .sidebar-link .fa-fw { margin-right: 0.5rem; }

        #main-content-area {
            width: 60%; /* Adjust based on sidebar widths */
            padding: 1.5rem; /* p-6 */
            overflow-y: auto;
            height: calc(100vh - 80px - 68px); /* Viewport height - header - footer approx heights */
        }

        .welcome-section {
            background-color: var(--sh-light-bg);
            padding: 2rem;
            border-radius: 0.5rem; /* rounded-lg */
            text-align: center;
            margin-bottom: 1.5rem; /* mb-6 */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .welcome-section h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.25rem; /* text-4xl */
            color: var(--sh-primary-dark);
            font-weight: 700;
        }
        .welcome-section .slogan {
            font-size: 1.125rem; /* text-lg */
            color: var(--sh-text-muted);
            margin-top: 0.5rem; /* mt-2 */
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem; /* gap-6 */
            margin-bottom: 1.5rem; /* mb-6 */
        }
        .content-card {
            background-color: var(--sh-light-bg);
            padding: 1.5rem; /* p-6 */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .did-you-know-card { background-color: var(--sh-light-yellow-bg); }
        .quiz-card { background-color: var(--sh-light-yellow-bg); }

        .card-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.25rem; /* text-xl */
            font-weight: 600;
            color: var(--sh-primary-blue);
            margin-bottom: 1rem; /* mb-4 */
        }
        .card-title i { margin-right: 0.5rem; }

        .dashboard-section .content-card { margin-bottom: 1rem; }

        .countdown-timer {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700;
            color: var(--sh-secondary-orange);
            text-align: center;
        }

        .quiz-question { margin-bottom: 0.75rem; }
        .quiz-options label { display: block; margin-bottom: 0.5rem; cursor: pointer; padding: 0.5rem; border-radius: 0.25rem; background-color: #FFF; }
        .quiz-options label:hover { background-color: #E0E0E0; }
        .quiz-options input[type="radio"] { margin-right: 0.5rem; }
        .quiz-button {
            background-color: var(--sh-primary-blue);
            color: var(--sh-text-light);
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .quiz-button:hover { background-color: #1565C0; /* Darker blue */ }
        .quiz-button.secondary { background-color: var(--sh-secondary-orange); }
        .quiz-button.secondary:hover { background-color: #EF6C00; /* Darker orange */ }

        #quiz-results p, #quiz-answers p { margin-bottom: 0.5rem; }
        .correct-answer { color: green; font-weight: bold; }
        .incorrect-answer { color: red; }

        .launch-message-section {
            background-color: var(--sh-light-blue-bg);
            padding: 2rem;
            border-radius: 0.5rem; /* rounded-lg */
            margin-bottom: 1.5rem; /* mb-6 */
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .launch-message-section h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem; /* text-2xl */
            color: var(--sh-primary-dark);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .why-choose-us-section .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        .why-choose-us-section .feature-item i {
            font-size: 1.5rem;
            color: var(--sh-primary-blue);
            margin-right: 1rem;
            width: 30px; /* Fixed width for icon alignment */
        }

        footer {
            background-color: var(--sh-primary-dark);
            color: var(--sh-text-light);
            padding: 1.5rem; /* p-6 */
            text-align: center;
        }
        .footer-links a {
            color: var(--sh-secondary-yellow);
            margin: 0 0.5rem; /* mx-2 */
        }
        .footer-links a:hover { text-decoration: underline; }
        .newsletter-form input[type="email"] {
            padding: 0.5rem;
            border-radius: 0.375rem 0 0 0.375rem;
            border: 1px solid var(--sh-primary-blue);
            color: var(--sh-text-dark);
        }
        .newsletter-form button {
            background-color: var(--sh-secondary-orange);
            color: var(--sh-text-light);
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0 0.375rem 0.375rem 0;
            cursor: pointer;
        }

        /* Chatbot Styles */
        #chatbot-container {
            position: fixed;
            bottom: 1.5rem; /* 24px */
            right: 1.5rem; /* 24px */
            z-index: 1000;
        }
        #chat-toggle-button {
            background-color: var(--sh-secondary-orange);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            font-size: 1.5rem; /* text-2xl */
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #chat-widget {
            width: 350px;
            max-height: 500px;
            background-color: white;
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            transform-origin: bottom right;
        }
        #chat-widget.hidden {
            transform: scale(0.5);
            opacity: 0;
            pointer-events: none;
        }
        #chat-header {
            background-color: var(--sh-primary-blue);
            color: white;
            padding: 0.75rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #chat-close-button {
            background: none;
            border: none;
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
        }
        #chat-messages {
            flex-grow: 1;
            padding: 0.75rem;
            overflow-y: auto;
            background-color: #F9FAFB; /* gray-50 */
        }
        .chat-message {
            margin-bottom: 0.75rem;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            max-width: 80%;
            word-wrap: break-word;
        }
        .user-message {
            background-color: var(--sh-primary-blue);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 0;
        }
        .bot-message {
            background-color: #E5E7EB; /* gray-200 */
            color: var(--sh-text-dark);
            margin-right: auto;
            border-bottom-left-radius: 0;
        }
        #chat-input-area {
            display: flex;
            padding: 0.75rem;
            border-top: 1px solid #E5E7EB; /* gray-200 */
        }
        #chat-input-area input {
            flex-grow: 1;
            padding: 0.5rem;
            border: 1px solid #D1D5DB; /* gray-300 */
            border-radius: 0.375rem 0 0 0.375rem;
            outline: none;
        }
        #chat-input-area button {
            background-color: var(--sh-secondary-orange);
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0 0.375rem 0.375rem 0;
            cursor: pointer;
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) { /* For tablets and smaller desktops */
            #left-sidebar, #right-sidebar { width: 25%; }
            #main-content-area { width: 50%; }
            .content-grid { grid-template-columns: 1fr; } /* Stack tip and quiz on smaller screens */
        }
        @media (max-width: 768px) { /* For mobile */
            .header-container { flex-direction: column; align-items: flex-start; padding: 1rem; }
            .header-nav { flex-direction: column; width: 100%; margin-top: 1rem; }
            .header-nav-item { width: 100%; margin-bottom: 0.5rem; }
            .header-actions { width: 100%; margin-top: 1rem; flex-direction: column; gap: 0.5rem; }
            .header-actions .search-bar, .header-actions .language-selector { width: 100%; }
            
            .main-container-wrapper { flex-direction: column; }
            #left-sidebar, #right-sidebar, #main-content-area {
                width: 100%;
                height: auto; /* Allow content to define height */
                max-height: none;
                border: none;
                box-shadow: none;
                margin-bottom: 1rem;
                overflow-y: visible;
            }
            #left-sidebar { order: 2; }
            #main-content-area { order: 1; padding-top: 1rem; } /* Reduce top padding if header is taller */
            #right-sidebar { order: 3; }
            .why-choose-us-section .grid { grid-template-columns: 1fr; }
        }

    </style>
</head>
<body>

    <header>
        <div class="header-container container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-20">
            <a href="/SafetyHelp/index.html" class="flex items-center">
                <img src="/SafetyHelp/assets/images/logo.png" alt="SafetyHelp Logo" class="logo-img mr-3"
                     onerror="this.onerror=null; this.src='https://placehold.co/150x50/0D47A1/FFFFFF?text=SafetyHelp';">
            </a>
            <nav class="header-nav hidden md:flex items-center space-x-2">
                <a href="/SafetyHelp/index.html" class="header-nav-item active" data-i18n="header.nav.home">Home</a>
                <a href="/SafetyHelp/resources.html" class="header-nav-item" data-i18n="header.nav.resources">Resources</a>
                <a href="/SafetyHelp/services.html" class="header-nav-item" data-i18n="header.nav.services">Services</a>
                <a href="/SafetyHelp/community.html" class="header-nav-item" data-i18n="header.nav.community">Community</a>
                <a href="/SafetyHelp/about.html" class="header-nav-item" data-i18n="header.nav.about">About</a>
                <a href="/SafetyHelp/contact.html" class="header-nav-item" data-i18n="header.nav.contact">Contact</a>
            </nav>
            <div class="header-actions flex items-center space-x-3">
                <div class="search-bar relative">
                    <input type="text" placeholder="Search..." data-i18n="[placeholder]header.search.placeholder"
                           class="px-3 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-var(--sh-secondary-orange) focus:border-transparent text-sm text-gray-700">
                    <button class="absolute right-0 top-0 h-full px-3 text-gray-500 hover:text-var(--sh-secondary-orange)">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="language-selector">
                    <select id="language-select" class="px-3 py-2 rounded-md border border-gray-300 bg-white text-sm text-gray-700 focus:ring-2 focus:ring-var(--sh-secondary-orange) focus:border-transparent">
                        <option value="en" data-i18n="language_selector.en">English</option>
                        <option value="xh" data-i18n="language_selector.xh">isiXhosa</option>
                        <option value="zu" data-i18n="language_selector.zu">isiZulu</option>
                        <option value="af" data-i18n="language_selector.af">Afrikaans</option>
                    </select>
                </div>
                <a href="/SafetyHelp/login.html" class="header-nav-item bg-var(--sh-secondary-orange) hover:bg-opacity-80" data-i18n="header.nav.login_signup">Login/Signup</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-2xl">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <nav id="mobile-menu" class="md:hidden hidden flex-col items-center space-y-2 p-4 bg-var(--sh-primary-dark)">
             <a href="/SafetyHelp/index.html" class="header-nav-item active w-full" data-i18n="header.nav.home">Home</a>
            <a href="/SafetyHelp/resources.html" class="header-nav-item w-full" data-i18n="header.nav.resources">Resources</a>
            <a href="/SafetyHelp/services.html" class="header-nav-item w-full" data-i18n="header.nav.services">Services</a>
            <a href="/SafetyHelp/community.html" class="header-nav-item w-full" data-i18n="header.nav.community">Community</a>
            <a href="/SafetyHelp/about.html" class="header-nav-item w-full" data-i18n="header.nav.about">About</a>
            <a href="/SafetyHelp/contact.html" class="header-nav-item w-full" data-i18n="header.nav.contact">Contact</a>
        </nav>
    </header>

    <div class="main-container-wrapper">
        <aside id="left-sidebar">
            <h2 class="sidebar-title" data-i18n="sidebar.tools_title"><i class="fas fa-tools mr-2"></i>SafetyHelp Tools</h2>
            <nav>
                <a href="#" class="sidebar-link active" data-i18n="sidebar.tools.dashboard"><i class="fas fa-tachometer-alt fa-fw"></i>Dashboard</a>
                <a href="#" class="sidebar-link" data-i18n="sidebar.tools.risk_assessments"><i class="fas fa-shield-alt fa-fw"></i>Risk Assessments</a>
                <a href="#" class="sidebar-link" data-i18n="sidebar.tools.incident_reporting"><i class="fas fa-file-medical-alt fa-fw"></i>Incident Reporting</a>
                <a href="#" class="sidebar-link" data-i18n="sidebar.tools.training_modules"><i class="fas fa-chalkboard-teacher fa-fw"></i>Training Modules</a>
                <a href="#" class="sidebar-link" data-i18n="sidebar.tools.document_management"><i class="fas fa-folder-open fa-fw"></i>Document Management</a>
                <a href="#" class="sidebar-link" data-i18n="sidebar.tools.compliance_checklists"><i class="fas fa-tasks fa-fw"></i>Compliance Checklists</a>
                <a href="#" class="sidebar-link" data-i18n="sidebar.tools.analytics_reports"><i class="fas fa-chart-line fa-fw"></i>Analytics & Reports</a>
            </nav>
        </aside>

        <main id="main-content-area">
            <section class="welcome-section">
                <h1 data-i18n="welcome.title">Welcome to SafetyHelp</h1>
                <p class="slogan" data-i18n="welcome.slogan">Safety Personalized, Compliance Simplifiedâ€”Anytime, Anywhere.</p>
            </section>

            <section class="content-grid">
                <div class="content-card did-you-know-card">
                    <h3 class="card-title" data-i18n="did_you_know.title"><i class="fas fa-lightbulb"></i>Did you know...</h3>
                    <p id="did-you-know-text" class="text-lg">âš¡ Using reputable ethical suppliers can reduce workplace hazards by ensuring work is done on time and to the highest quality and safety standards?</p>
                </div>
                <div class="content-card quiz-card">
                    <h3 class="card-title" data-i18n="quiz.title"><i class="fas fa-brain"></i>Brain of SafetyHelp - Daily Challenge!</h3>
                    <div id="quiz-area">
                        <div id="quiz-question-area">
                            </div>
                        <div id="quiz-user-input" class="mt-4 hidden">
                            <input type="text" id="quiz-user-name" placeholder="Enter your name" class="p-2 border rounded-md w-full mb-2">
                            <input type="email" id="quiz-user-email" placeholder="Enter your email (optional)" class="p-2 border rounded-md w-full mb-2">
                            <button id="quiz-submit-score" class="quiz-button w-full">Register Score</button>
                        </div>
                        <div id="quiz-results" class="mt-4 hidden"></div>
                        <div id="quiz-answers" class="mt-4 hidden"></div>
                        <div class="mt-4 flex justify-between">
                            <button id="quiz-start-button" class="quiz-button">Start Quiz</button>
                            <button id="quiz-next-button" class="quiz-button hidden">Next Question</button>
                            <button id="quiz-continue-button" class="quiz-button secondary hidden">Continue Quiz (Next 5)</button>
                        </div>
                    </div>
                </div>
            </section>

            <section class="dashboard-section">
                <h2 class="text-2xl font-bold mb-4 text-var(--sh-primary-dark)" data-i18n="dashboard.title"><i class="fas fa-columns mr-2"></i>Dashboard</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="content-card">
                        <h3 class="card-title" data-i18n="dashboard.timer_title"><i class="fas fa-hourglass-half"></i>Next Module Countdown</h3>
                        <div id="countdown-timer" class="countdown-timer">00d 00h 00m 00s</div>
                        <p class="text-sm text-center text-var(--sh-text-muted) mt-2" data-i18n="dashboard.timer_caption">until the next module launch!</p>
                    </div>
                    <div class="content-card">
                        <h3 class="card-title" data-i18n="dashboard.brain_title"><i class="fas fa-trophy"></i>SafetyHelp Brain of the Day</h3>
                        <p id="brain-of-the-day" class="text-lg font-semibold text-var(--sh-primary-blue)">Fetching leader...</p>
                    </div>
                    <div class="content-card">
                        <h3 class="card-title" data-i18n="dashboard.podcast_title"><i class="fas fa-podcast"></i>Latest Podcast</h3>
                        <a href="#" class="text-var(--sh-primary-blue) hover:underline" data-i18n="dashboard.podcast_link">Listen to: OHS Innovations in 2025 <i class="fas fa-external-link-alt ml-1"></i></a>
                    </div>
                    <div class="content-card">
                        <h3 class="card-title" data-i18n="dashboard.article_title"><i class="fas fa-newspaper"></i>Latest Article</h3>
                        <a href="#" class="text-var(--sh-primary-blue) hover:underline" data-i18n="dashboard.article_link">Read: Mastering Risk Assessments <i class="fas fa-external-link-alt ml-1"></i></a>
                    </div>
                </div>
            </section>

            <section class="launch-message-section">
                <h2 data-i18n="launch.title">ðŸš€ SafetyHelp Has Launched!</h2>
                <p class="mb-2" data-i18n="launch.core_platform">The core SafetyHelp platform was successfully launched on <strong>June 1, 2025!</strong> We're excited to bring you a new era of OHS management.</p>
                <p class="mb-2" data-i18n="launch.upcoming_modules">Stay tuned for new and advanced modules launching every month! Our next module is just around the corner (see countdown above).</p>
                <p data-i18n="launch.beta_invite">Be a pioneer in OHS excellence! <a href="#" class="font-bold text-var(--sh-secondary-orange) hover:underline">Join our Beta Program</a> to test new features, influence development, and get complimentary premium access during the testing period. <a href="/SafetyHelp/register.html" class="font-bold text-var(--sh-secondary-orange) hover:underline">Register now!</a></p>
            </section>

            <section class="why-choose-us-section content-card">
                <h2 class="card-title text-2xl font-bold mb-6 text-center text-var(--sh-primary-dark)" data-i18n="why_choose_us.title">Why Choose SafetyHelp?</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                    <div class="feature-item">
                        <i class="fas fa-robot fa-fw"></i>
                        <div>
                            <h4 class="font-semibold text-lg" data-i18n="why_choose_us.ai_automation.title">AI Automation</h4>
                            <p class="text-sm text-var(--sh-text-muted)" data-i18n="why_choose_us.ai_automation.desc">Intelligent task streamlining and risk prediction.</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-chart-pie fa-fw"></i>
                        <div>
                            <h4 class="font-semibold text-lg" data-i18n="why_choose_us.analytics.title">Insightful Analytics</h4>
                            <p class="text-sm text-var(--sh-text-muted)" data-i18n="why_choose_us.analytics.desc">Data-driven safety decisions and trend analysis.</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-mobile-alt fa-fw"></i>
                        <div>
                            <h4 class="font-semibold text-lg" data-i18n="why_choose_us.mobile.title">Mobile Accessibility</h4>
                            <p class="text-sm text-var(--sh-text-muted)" data-i18n="why_choose_us.mobile.desc">OHS management on the go, anytime, anywhere.</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-cubes fa-fw"></i>
                        <div>
                            <h4 class="font-semibold text-lg" data-i18n="why_choose_us.modules.title">Integrated Modules</h4>
                            <p class="text-sm text-var(--sh-text-muted)" data-i18n="why_choose_us.modules.desc">A holistic OHS ecosystem for comprehensive coverage.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <aside id="right-sidebar">
            <h2 class="sidebar-title" data-i18n="sidebar.milestones_title"><i class="fas fa-flag-checkered mr-2"></i>OHS Milestones</h2>
            <ul class="space-y-3">
                <li class="flex items-start">
                    <i class="fas fa-calendar-alt text-var(--sh-primary-blue) mt-1 mr-2"></i>
                    <div>
                        <strong class="block" data-i18n="milestones.y1970.year">1970:</strong>
                        <span class="text-sm text-var(--sh-text-muted)" data-i18n="milestones.y1970.desc">OSHA (USA) established, influencing global standards.</span>
                    </div>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-calendar-alt text-var(--sh-primary-blue) mt-1 mr-2"></i>
                    <div>
                        <strong class="block" data-i18n="milestones.y1993.year">1993:</strong>
                        <span class="text-sm text-var(--sh-text-muted)" data-i18n="milestones.y1993.desc">OHS Act (South Africa) enacted, a cornerstone of local OHS.</span>
                    </div>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-calendar-alt text-var(--sh-primary-blue) mt-1 mr-2"></i>
                    <div>
                        <strong class="block" data-i18n="milestones.y2003.year">2003:</strong>
                        <span class="text-sm text-var(--sh-text-muted)" data-i18n="milestones.y2003.desc">COIDA Amendment Act, refining worker compensation.</span>
                    </div>
                </li>
                 <li class="flex items-start">
                    <i class="fas fa-calendar-alt text-var(--sh-primary-blue) mt-1 mr-2"></i>
                    <div>
                        <strong class="block" data-i18n="milestones.y2015.year">2015:</strong>
                        <span class="text-sm text-var(--sh-text-muted)" data-i18n="milestones.y2015.desc">Global Harmonization System (GHS) for chemical safety.</span>
                    </div>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-calendar-alt text-var(--sh-primary-blue) mt-1 mr-2"></i>
                    <div>
                        <strong class="block" data-i18n="milestones.y2022.year">2022:</strong>
                        <span class="text-sm text-var(--sh-text-muted)" data-i18n="milestones.y2022.desc">Increased focus on Mental Health in the Workplace.</span>
                    </div>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-calendar-alt text-var(--sh-primary-blue) mt-1 mr-2"></i>
                    <div>
                        <strong class="block" data-i18n="milestones.future.year">Future:</strong>
                        <span class="text-sm text-var(--sh-text-muted)" data-i18n="milestones.future.desc">Predictive Safety using AI and Big Data.</span>
                    </div>
                </li>
            </ul>
        </aside>
    </div>

    <footer>
        <div class="container mx-auto px-6">
            <div class="newsletter mb-6">
                <h3 class="text-lg font-semibold mb-2" data-i18n="footer.newsletter.title">Stay Updated with SafetyHelp</h3>
                <form class="newsletter-form flex justify-center max-w-md mx-auto">
                    <input type="email" placeholder="Enter your email" data-i18n="[placeholder]footer.newsletter.placeholder" aria-label="Email for newsletter">
                    <button type="submit" data-i18n="footer.newsletter.button">Subscribe</button>
                </form>
            </div>
            <div class="footer-links mb-4">
                <a href="/SafetyHelp/privacy.html" data-i18n="footer.links.privacy">Privacy Policy</a> |
                <a href="/SafetyHelp/terms.html" data-i18n="footer.links.terms">Terms of Service</a> |
                <a href="/SafetyHelp/contact.html" data-i18n="footer.links.contact">Contact Us</a>
            </div>
            <p class="text-sm" data-i18n="footer.copyright">&copy; 2025 SafetyHelp. All rights reserved. Designed by Salatiso Lonwabo Mdeni.</p>
        </div>
    </footer>

    <div id="chatbot-container">
        <button id="chat-toggle-button">
            <i class="fas fa-comments"></i>
        </button>
        <div id="chat-widget" class="hidden">
            <div id="chat-header">
                <span data-i18n="chatbot.title">SafetyHelp Assistant</span>
                <button id="chat-close-button"><i class="fas fa-times"></i></button>
            </div>
            <div id="chat-messages">
                <div class="bot-message" data-i18n="chatbot.welcome_message">Hello! How can I assist you with OHS today?</div>
            </div>
            <div id="chat-input-area">
                <input type="text" id="chat-user-input" placeholder="Type your question..." data-i18n="[placeholder]chatbot.input_placeholder">
                <button id="chat-send-button"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, query, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // IMPORTANT: Replace with your actual Firebase project configuration!
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        let app;
        let db;
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log("Firebase initialized successfully.");
        } catch (e) {
            console.error("Firebase initialization failed. Using mock data. Error:", e);
            // Fallback or mock data initialization if Firebase fails
            db = null; // Ensure db is null if Firebase fails
        }
        
        // --- Translations (i18next) ---
        const translations = {
            en: {
                translation: {
                    "header.nav.home": "Home",
                    "header.nav.resources": "Resources",
                    "header.nav.services": "Services",
                    "header.nav.community": "Community",
                    "header.nav.about": "About",
                    "header.nav.contact": "Contact",
                    "header.nav.login_signup": "Login/Signup",
                    "header.search.placeholder": "Search...",
                    "language_selector.en": "English",
                    "language_selector.xh": "isiXhosa",
                    "language_selector.zu": "isiZulu",
                    "language_selector.af": "Afrikaans",
                    "sidebar.tools_title": "SafetyHelp Tools",
                    "sidebar.tools.dashboard": "Dashboard",
                    "sidebar.tools.risk_assessments": "Risk Assessments",
                    "sidebar.tools.incident_reporting": "Incident Reporting",
                    "sidebar.tools.training_modules": "Training Modules",
                    "sidebar.tools.document_management": "Document Management",
                    "sidebar.tools.compliance_checklists": "Compliance Checklists",
                    "sidebar.tools.analytics_reports": "Analytics & Reports",
                    "sidebar.milestones_title": "OHS Milestones",
                    "milestones.y1970.year": "1970:", "milestones.y1970.desc": "OSHA (USA) established.",
                    "milestones.y1993.year": "1993:", "milestones.y1993.desc": "OHS Act (South Africa) enacted.",
                    "milestones.y2003.year": "2003:", "milestones.y2003.desc": "COIDA Amendment Act.",
                    "milestones.y2015.year": "2015:", "milestones.y2015.desc": "Global Harmonization System (GHS).",
                    "milestones.y2022.year": "2022:", "milestones.y2022.desc": "Focus on Mental Health in Workplace.",
                    "milestones.future.year": "Future:", "milestones.future.desc": "Predictive Safety (AI & Big Data).",
                    "welcome.title": "Welcome to SafetyHelp",
                    "welcome.slogan": "Safety Personalized, Compliance Simplifiedâ€”Anytime, Anywhere.",
                    "did_you_know.title": "Did you know...",
                    "quiz.title": "Brain of SafetyHelp - Daily Challenge!",
                    "dashboard.title": "Dashboard",
                    "dashboard.timer_title": "Next Module Countdown",
                    "dashboard.timer_caption": "until the next module launch!",
                    "dashboard.brain_title": "SafetyHelp Brain of the Day",
                    "dashboard.podcast_title": "Latest Podcast",
                    "dashboard.podcast_link": "Listen to: OHS Innovations in 2025",
                    "dashboard.article_title": "Latest Article",
                    "dashboard.article_link": "Read: Mastering Risk Assessments",
                    "launch.title": "ðŸš€ SafetyHelp Has Launched!",
                    "launch.core_platform": "The core SafetyHelp platform was successfully launched on <strong>June 1, 2025!</strong> We're excited to bring you a new era of OHS management.",
                    "launch.upcoming_modules": "Stay tuned for new and advanced modules launching every month! Our next module is just around the corner (see countdown above).",
                    "launch.beta_invite": "Be a pioneer in OHS excellence! <a href='#' class='font-bold text-var(--sh-secondary-orange) hover:underline'>Join our Beta Program</a> to test new features, influence development, and get complimentary premium access during the testing period. <a href='/SafetyHelp/register.html' class='font-bold text-var(--sh-secondary-orange) hover:underline'>Register now!</a>",
                    "why_choose_us.title": "Why Choose SafetyHelp?",
                    "why_choose_us.ai_automation.title": "AI Automation", "why_choose_us.ai_automation.desc": "Intelligent task streamlining and risk prediction.",
                    "why_choose_us.analytics.title": "Insightful Analytics", "why_choose_us.analytics.desc": "Data-driven safety decisions and trend analysis.",
                    "why_choose_us.mobile.title": "Mobile Accessibility", "why_choose_us.mobile.desc": "OHS management on the go, anytime, anywhere.",
                    "why_choose_us.modules.title": "Integrated Modules", "why_choose_us.modules.desc": "A holistic OHS ecosystem for comprehensive coverage.",
                    "footer.newsletter.title": "Stay Updated with SafetyHelp",
                    "footer.newsletter.placeholder": "Enter your email",
                    "footer.newsletter.button": "Subscribe",
                    "footer.links.privacy": "Privacy Policy",
                    "footer.links.terms": "Terms of Service",
                    "footer.links.contact": "Contact Us",
                    "footer.copyright": "&copy; 2025 SafetyHelp. All rights reserved. Designed by Salatiso Lonwabo Mdeni.",
                    "chatbot.title": "SafetyHelp Assistant",
                    "chatbot.welcome_message": "Hello! How can I assist you with OHS today?",
                    "chatbot.input_placeholder": "Type your question..."
                }
                // Add other languages here
            }
        };

        i18next
            .use(i18nextBrowserLanguageDetector)
            .init({
                debug: true,
                fallbackLng: 'en',
                resources: translations
            }, function(err, t) {
                updateUIWithTranslations();
            });

        document.getElementById('language-select').addEventListener('change', (event) => {
            i18next.changeLanguage(event.target.value, (err,t) => {
                if (err) return console.error('Error changing language', err);
                updateUIWithTranslations();
            });
        });

        function updateUIWithTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (key.startsWith('[placeholder]')) {
                    el.setAttribute('placeholder', i18next.t(key.substring('[placeholder]'.length)));
                } else {
                    el.innerHTML = i18next.t(key);
                }
            });
            // Update title specifically
            document.title = i18next.t('SafetyHelp - Your Partner in OHS Excellence'); // Example, adjust key
        }


        // --- Mobile Menu Toggle ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // --- Countdown Timer ---
        const countdownElement = document.getElementById('countdown-timer');
        function updateCountdown() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            // Target the end of the current month
            const nextMonth = new Date(currentYear, currentMonth + 1, 1); // First day of next month
            const targetDate = new Date(nextMonth.getTime() - 1); // Last millisecond of current month

            const diff = targetDate - now;

            if (diff <= 0) {
                countdownElement.innerHTML = "New Module Launched!";
                // Potentially trigger logic for new month here
                return;
            }

            const d = Math.floor(diff / (1000 * 60 * 60 * 24));
            const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);

            countdownElement.innerHTML = `${d}d ${h}h ${m}m ${s}s`;
        }
        setInterval(updateCountdown, 1000);
        updateCountdown(); // Initial call

        // --- "Did you know..." Tips ---
        const didYouKnowTextElement = document.getElementById('did-you-know-text');
        const mockTips = [
            "âš¡ Regular safety briefings can reduce accidents by up to 30%.",
            "ðŸ’¡ Proper ergonomic setups prevent long-term musculoskeletal disorders.",
            "ðŸ”§ Ensuring machinery is regularly maintained significantly lowers breakdown risks.",
            "âš ï¸ Clear labeling of hazardous materials is crucial for workplace safety."
        ];

        async function fetchRandomTip() {
            if (db) {
                try {
                    const tipsCollection = collection(db, "did_you_know_tips");
                    const snapshot = await getDocs(tipsCollection);
                    if (!snapshot.empty) {
                        const tips = snapshot.docs.map(doc => doc.data().tip_text);
                        const randomIndex = Math.floor(Math.random() * tips.length);
                        didYouKnowTextElement.textContent = tips[randomIndex];
                    } else {
                        didYouKnowTextElement.textContent = mockTips[Math.floor(Math.random() * mockTips.length)];
                    }
                } catch (error) {
                    console.error("Error fetching tip:", error);
                    didYouKnowTextElement.textContent = mockTips[Math.floor(Math.random() * mockTips.length)];
                }
            } else {
                 didYouKnowTextElement.textContent = mockTips[Math.floor(Math.random() * mockTips.length)];
            }
        }
        fetchRandomTip();
        setInterval(fetchRandomTip, 30000); // Change tip every 30 seconds


        // --- Brain of SafetyHelp Quiz ---
        const quizArea = document.getElementById('quiz-area');
        const quizQuestionArea = document.getElementById('quiz-question-area');
        const quizUserInput = document.getElementById('quiz-user-input');
        const quizUserNameInput = document.getElementById('quiz-user-name');
        const quizUserEmailInput = document.getElementById('quiz-user-email');
        const quizSubmitScoreButton = document.getElementById('quiz-submit-score');
        const quizResultsArea = document.getElementById('quiz-results');
        const quizAnswersArea = document.getElementById('quiz-answers');
        const quizStartButton = document.getElementById('quiz-start-button');
        const quizNextButton = document.getElementById('quiz-next-button');
        const quizContinueButton = document.getElementById('quiz-continue-button');

        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let questionsAnsweredInSet = 0;
        const questionsPerSet = 5;

        const mockQuizQuestions = [
            { id: "q1", question_text: "What does PPE stand for?", options: ["Personal Protective Equipment", "People Protecting Environment", "Productive Process Enhancement"], correct_answer_index: 0 },
            { id: "q2", question_text: "Which color typically signifies 'danger' or 'stop' on safety signs?", options: ["Green", "Yellow", "Red", "Blue"], correct_answer_index: 2 },
            { id: "q3", question_text: "What is a primary goal of a risk assessment?", options: ["To assign blame after an incident", "To identify and control hazards", "To complete paperwork", "To increase insurance premiums"], correct_answer_index: 1 },
            { id: "q4", question_text: "An emergency exit should always be:", options: ["Locked for security", "Clearly marked and unobstructed", "Used for storage", "Painted yellow"], correct_answer_index: 1 },
            { id: "q5", question_text: "What does 'COIDA' stand for in South Africa?", options: ["Company of International Development Aid", "Compensation for Occupational Injuries and Diseases Act", "Council of Industrial Development and Assistance"], correct_answer_index: 1 },
            { id: "q6", question_text: "What is the first step in using a fire extinguisher (PASS method)?", options: ["Aim", "Squeeze", "Sweep", "Pull"], correct_answer_index: 3 },
            { id: "q7", question_text: "A 'Toolbox Talk' is typically a:", options: ["Long training seminar", "Formal audit process", "Short, informal safety meeting", "Disciplinary hearing"], correct_answer_index: 2 },
            { id: "q8", question_text: "Who is responsible for workplace safety?", options: ["Only the employer", "Only the employees", "Everyone in the workplace", "The safety officer only"], correct_answer_index: 2 },
            { id: "q9", question_text: "What is a common hazard in an office environment?", options: ["Falling objects from height", "Chemical spills", "Trailing cables", "Loud machinery noise"], correct_answer_index: 2 },
            { id: "q10", question_text: "The OHS Act in South Africa was promulgated in:", options: ["1970", "1993", "2003", "2015"], correct_answer_index: 1 },
        ];
        let allQuizQuestions = []; // To store fetched or mock questions
        let usedQuestionIds = new Set();


        async function fetchQuizQuestions() {
            quizStartButton.disabled = true;
            quizStartButton.textContent = "Loading Questions...";
            if (db) {
                try {
                    const questionsCollection = collection(db, "quiz_questions");
                    const snapshot = await getDocs(questionsCollection);
                    if (!snapshot.empty) {
                        allQuizQuestions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    } else {
                        allQuizQuestions = [...mockQuizQuestions]; // Use a copy
                    }
                } catch (error) {
                    console.error("Error fetching quiz questions:", error);
                    allQuizQuestions = [...mockQuizQuestions]; // Use a copy
                }
            } else {
                allQuizQuestions = [...mockQuizQuestions]; // Use a copy
            }
            quizStartButton.disabled = false;
            quizStartButton.textContent = "Start Quiz";
        }

        function startNewQuizSet() {
            currentQuestions = [];
            const availableQuestions = allQuizQuestions.filter(q => !usedQuestionIds.has(q.id));
            
            if (availableQuestions.length < questionsPerSet) {
                quizQuestionArea.innerHTML = "<p>You've attempted all available questions! Check back later for more.</p>";
                quizNextButton.classList.add('hidden');
                quizContinueButton.classList.add('hidden');
                quizUserInput.classList.remove('hidden'); // Allow score submission if any questions were answered
                return;
            }

            // Shuffle and pick questionsPerSet
            const shuffled = availableQuestions.sort(() => 0.5 - Math.random());
            currentQuestions = shuffled.slice(0, questionsPerSet);
            currentQuestions.forEach(q => usedQuestionIds.add(q.id));

            currentQuestionIndex = 0;
            questionsAnsweredInSet = 0;
            quizResultsArea.classList.add('hidden');
            quizAnswersArea.classList.add('hidden');
            quizUserInput.classList.add('hidden');
            quizNextButton.classList.remove('hidden');
            quizNextButton.textContent = "Submit Answer";
            quizContinueButton.classList.add('hidden');
            displayQuestion();
        }
        
        quizStartButton.addEventListener('click', async () => {
            await fetchQuizQuestions(); // Ensure questions are loaded
            if (allQuizQuestions.length === 0) {
                 quizQuestionArea.innerHTML = "<p>No quiz questions available at the moment. Please try again later.</p>";
                 return;
            }
            score = 0; // Reset score for a new full quiz session
            usedQuestionIds.clear(); // Clear used questions for a new session
            quizStartButton.classList.add('hidden');
            startNewQuizSet();
        });

        function displayQuestion() {
            if (currentQuestionIndex < currentQuestions.length) {
                const q = currentQuestions[currentQuestionIndex];
                let optionsHTML = "";
                q.options.forEach((option, index) => {
                    optionsHTML += `
                        <label class="block p-2 my-1 border rounded hover:bg-gray-100 cursor-pointer">
                            <input type="radio" name="quizOption" value="${index}" class="mr-2"> ${option}
                        </label>
                    `;
                });
                quizQuestionArea.innerHTML = `
                    <p class="quiz-question font-semibold">${currentQuestionIndex + 1}. ${q.question_text}</p>
                    <div class="quiz-options">${optionsHTML}</div>
                `;
            }
        }

        quizNextButton.addEventListener('click', () => {
            const selectedOption = quizArea.querySelector('input[name="quizOption"]:checked');
            if (!selectedOption) {
                alert("Please select an answer.");
                return;
            }

            const answerIndex = parseInt(selectedOption.value);
            const currentQ = currentQuestions[currentQuestionIndex];
            currentQ.userAnswerIndex = answerIndex; // Store user's answer

            if (answerIndex === currentQ.correct_answer_index) {
                score++;
            }
            
            questionsAnsweredInSet++;
            currentQuestionIndex++;

            if (questionsAnsweredInSet >= questionsPerSet || currentQuestionIndex >= currentQuestions.length) {
                showSetResults();
            } else {
                displayQuestion();
            }
        });

        function showSetResults() {
            quizQuestionArea.innerHTML = ""; // Clear question
            quizNextButton.classList.add('hidden');
            
            quizResultsArea.innerHTML = `<p class="font-bold">Set Complete! Your current total score: ${score}</p>`;
            quizResultsArea.classList.remove('hidden');

            let answersHTML = '<h4 class="font-semibold mt-2 mb-1">Answers for this set:</h4>';
            currentQuestions.slice(currentQuestionIndex - questionsAnsweredInSet, currentQuestionIndex).forEach((q, idx) => {
                const userAnswer = q.options[q.userAnswerIndex];
                const correctAnswer = q.options[q.correct_answer_index];
                const isCorrect = q.userAnswerIndex === q.correct_answer_index;
                answersHTML += `
                    <p><strong>Q${idx + 1}: ${q.question_text}</strong></p>
                    <p>Your answer: <span class="${isCorrect ? 'correct-answer' : 'incorrect-answer'}">${userAnswer}</span></p>
                    ${!isCorrect ? `<p>Correct answer: <span class="correct-answer">${correctAnswer}</span></p>` : ''}
                    <hr class="my-1">
                `;
            });
            quizAnswersArea.innerHTML = answersHTML;
            quizAnswersArea.classList.remove('hidden');

            quizUserInput.classList.remove('hidden');
            if (allQuizQuestions.filter(q => !usedQuestionIds.has(q.id)).length >= questionsPerSet) {
                quizContinueButton.classList.remove('hidden');
            } else {
                quizContinueButton.classList.add('hidden');
                quizResultsArea.innerHTML += "<p>You've attempted all available questions!</p>";
            }
        }
        
        quizContinueButton.addEventListener('click', () => {
            questionsAnsweredInSet = 0; // Reset for the new set
            startNewQuizSet();
        });

        quizSubmitScoreButton.addEventListener('click', async () => {
            const userName = quizUserNameInput.value.trim();
            const userEmail = quizUserEmailInput.value.trim();

            if (!userName) {
                alert("Please enter your name to register your score.");
                return;
            }
            if (db) {
                try {
                    await addDoc(collection(db, "quiz_leaderboard"), {
                        user_name: userName,
                        user_email: userEmail || null,
                        score: score,
                        timestamp: serverTimestamp()
                    });
                    alert("Score submitted successfully!");
                    quizUserInput.classList.add('hidden');
                    quizContinueButton.classList.add('hidden'); // Hide continue after submitting
                    quizStartButton.classList.remove('hidden'); // Show start button for a new session
                    fetchBrainOfTheDay(); // Refresh leader
                } catch (error) {
                    console.error("Error submitting score:", error);
                    alert("Failed to submit score. Please try again.");
                }
            } else {
                alert("Database not available. Score not submitted. Mock submission logged.");
                console.log(`Mock Score Submission: Name: ${userName}, Email: ${userEmail}, Score: ${score}`);
                quizUserInput.classList.add('hidden');
                quizContinueButton.classList.add('hidden');
                quizStartButton.classList.remove('hidden');
            }
        });


        // --- Brain of the Day Display ---
        const brainOfTheDayElement = document.getElementById('brain-of-the-day');
        async function fetchBrainOfTheDay() {
            if (db) {
                try {
                    const q = query(collection(db, "quiz_leaderboard"), orderBy("score", "desc"), orderBy("timestamp", "asc"), limit(1));
                    const snapshot = await getDocs(q);
                    if (!snapshot.empty) {
                        const leader = snapshot.docs[0].data();
                        brainOfTheDayElement.textContent = `${leader.user_name} (${leader.score} points)`;
                    } else {
                        brainOfTheDayElement.textContent = "No scores yet. Be the first!";
                    }
                } catch (error) {
                    console.error("Error fetching brain of the day:", error);
                    brainOfTheDayElement.textContent = "Could not load leader.";
                }
            } else {
                 brainOfTheDayElement.textContent = "Leaderboard unavailable.";
            }
        }
        fetchBrainOfTheDay(); // Initial fetch


        // --- Chatbot Functionality ---
        const chatToggleButton = document.getElementById('chat-toggle-button');
        const chatWidget = document.getElementById('chat-widget');
        const chatCloseButton = document.getElementById('chat-close-button');
        const chatMessages = document.getElementById('chat-messages');
        const chatUserInput = document.getElementById('chat-user-input');
        const chatSendButton = document.getElementById('chat-send-button');

        chatToggleButton.addEventListener('click', () => {
            chatWidget.classList.toggle('hidden');
            if (!chatWidget.classList.contains('hidden')) {
                chatUserInput.focus();
            }
        });

        chatCloseButton.addEventListener('click', () => {
            chatWidget.classList.add('hidden');
        });

        async function handleChatbotSendMessage() {
            const messageText = chatUserInput.value.trim();
            if (messageText === "") return;

            appendChatMessage(messageText, 'user-message');
            chatUserInput.value = "";
            
            // Simulate bot thinking and response
            appendChatMessage("Thinking...", 'bot-message', true); // Add thinking indicator

            // Call Gemini API
            try {
                let chatHistory = [{ role: "user", parts: [{ text: messageText }] }];
                const payload = { contents: chatHistory };
                const apiKey = ""; // Leave empty, Canvas will provide
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }
                
                const result = await response.json();
                
                // Remove "Thinking..." message
                const thinkingMessageElement = chatMessages.querySelector('.thinking');
                if (thinkingMessageElement) thinkingMessageElement.remove();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const botResponse = result.candidates[0].content.parts[0].text;
                    appendChatMessage(botResponse, 'bot-message');
                } else {
                    appendChatMessage("Sorry, I couldn't get a response. Please try again.", 'bot-message');
                }
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                 const thinkingMessageElement = chatMessages.querySelector('.thinking');
                if (thinkingMessageElement) thinkingMessageElement.remove();
                appendChatMessage("Sorry, there was an error processing your request.", 'bot-message');
            }
        }

        chatSendButton.addEventListener('click', handleChatbotSendMessage);
        chatUserInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleChatbotSendMessage();
            }
        });

        function appendChatMessage(text, type, isThinking = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-message', type);
            if (isThinking) {
                messageDiv.classList.add('thinking'); // Class to identify the thinking message
            }
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Initial setup calls
        fetchQuizQuestions(); // Load quiz questions on page load

    </script>
</body>
</html>
