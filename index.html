<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafetyHelp - Your Partner in OHS Compliance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        // These are for V9, modular SDK. For V8 (compat), use firebase.initializeApp etc.
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, setDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAnalytics, setUserId as setAnalyticsUserId } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";

        // Your web app's Firebase configuration
        // IMPORTANT: Replace with your actual Firebase config if you have one.
        // For demonstration, using placeholder values.
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "YOUR_API_KEY", // Replace if not using __firebase_config
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID",
            measurementId: "YOUR_MEASUREMENT_ID"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        // const analytics = getAnalytics(app); // Enable if you need analytics

        // Expose Firebase services to global scope for easier access in other scripts if needed
        window.firebaseDB = db;
        window.firebaseAuth = auth;

        // Firestore App ID (replace with your actual app ID if not using __app_id)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'safetyhelp-app';
        window.appId = appId; // Make appId globally available

        // Authentication
        let currentUserId = null;
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUserId = user.uid;
                console.log("User is signed in:", currentUserId);
                // If using analytics and you want to set user ID
                // if (typeof analytics !== 'undefined') {
                //     setAnalyticsUserId(analytics, currentUserId);
                // }
            } else {
                console.log("User is signed out or not yet signed in.");
                // Attempt to sign in with custom token if available, otherwise anonymously
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    try {
                        await signInWithCustomToken(auth, __initial_auth_token);
                        console.log("Signed in with custom token.");
                    } catch (error) {
                        console.error("Error signing in with custom token, trying anonymous:", error);
                        await signInAnonymously(auth);
                        console.log("Signed in anonymously after custom token failure.");
                    }
                } else {
                    await signInAnonymously(auth);
                    console.log("Signed in anonymously.");
                }
            }
            window.currentUserId = auth.currentUser ? auth.currentUser.uid : crypto.randomUUID(); // Ensure userId is set
        });


    </script>


    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Prevent scrolling on the body */
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #f0f4f8; /* Light background for the page */
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .header-bg {
            background-color: #1E3A8A; /* Dark blue for header */
        }
        .welcome-bg {
            background-color: #3B82F6; /* Lighter blue for welcome section */
        }
        .nav-button {
            transition: all 0.3s ease;
        }
        .nav-button:hover {
            background-color: #2563EB; /* Slightly darker blue on hover */
            transform: translateY(-2px);
        }
        .icon-placeholder {
            width: 24px;
            height: 24px;
            display: inline-block;
        }
        .clickable-box {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s ease-in-out;
        }
        .clickable-box:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        /* Chatbot styling */
        #chatbotContainer {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        #chatbotToggle {
            background-color: #1E3A8A; /* Dark blue */
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #chatbotWindow {
            width: 350px;
            height: 450px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            transform-origin: bottom right;
        }
        #chatbotWindow.hidden {
            transform: scale(0);
            opacity: 0;
        }
        #chatHeader {
            background-color: #1E3A8A; /* Dark blue */
            color: white;
            padding: 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #closeChat {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        #chatMessages {
            flex-grow: 1;
            padding: 10px;
            overflow-y: auto;
            background-color: #f9fafb; /* Light gray for messages background */
        }
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #3B82F6; /* Lighter blue */
            color: white;
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        .bot-message {
            background-color: #e5e7eb; /* Light gray for bot messages */
            color: #1f2937; /* Dark gray text */
            align-self: flex-start;
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }
        #chatInputContainer {
            display: flex;
            padding: 10px;
            border-top: 1px solid #e5e7eb; /* Light gray border */
        }
        #chatInput {
            flex-grow: 1;
            border: 1px solid #d1d5db; /* Gray border */
            border-radius: 20px;
            padding: 10px 15px;
            margin-right: 10px;
            outline: none;
        }
        #sendButton {
            background-color: #1E3A8A; /* Dark blue */
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #sendButton:hover {
            background-color: #1D4ED8; /* Slightly lighter blue on hover */
        }
        /* Quiz Modal */
        .quiz-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1100; /* Higher than chatbot */
        }
        .quiz-modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="header-bg text-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <a href="#" class="flex items-center space-x-2">
                <img src="https://placehold.co/120x40/ffffff/1E3A8A?text=SafetyHelp&font=Inter" alt="SafetyHelp Logo" id="logoLink" class="h-8 md:h-10">
            </a>

            <nav class="hidden md:flex items-center space-x-2">
                <a href="#" class="clickable-box nav-button">
                    <span class="lucide icon-placeholder" data-lucide="Home"></span> Home
                </a>
                <a href="#" class="clickable-box nav-button">
                    <span class="lucide icon-placeholder" data-lucide="BookOpen"></span> Resources
                </a>
                <a href="#" class="clickable-box nav-button">
                    <span class="lucide icon-placeholder" data-lucide="Briefcase"></span> Services
                </a>
                <a href="#" class="clickable-box nav-button">
                    <span class="lucide icon-placeholder" data-lucide="Users"></span> Community
                </a>
                <a href="#" class="clickable-box nav-button">
                    <span class="lucide icon-placeholder" data-lucide="Info"></span> About
                </a>
                <a href="#" class="clickable-box nav-button">
                    <span class="lucide icon-placeholder" data-lucide="Mail"></span> Contact
                </a>
            </nav>

            <div class="flex items-center space-x-3">
                <div class="hidden sm:flex items-center bg-white bg-opacity-20 rounded-full px-2 py-1">
                    <span class="lucide text-white mr-1" data-lucide="Search" style="width: 18px; height: 18px;"></span>
                    <input type="search" placeholder="Search..." class="bg-transparent text-white placeholder-gray-300 text-sm focus:outline-none w-24 md:w-32">
                </div>
                <div class="relative">
                    <select id="languageSelector" class="bg-white bg-opacity-20 text-white text-sm rounded-full py-1 px-2 focus:outline-none appearance-none">
                        <option value="en">EN</option>
                        <option value="zu">ZU</option>
                        <option value="xh">XH</option>
                        <option value="af">AF</option>
                    </select>
                    <span class="lucide text-white absolute right-1 top-1/2 transform -translate-y-1/2 pointer-events-none" data-lucide="ChevronDown" style="width: 16px; height: 16px;"></span>
                </div>
                 <a href="login.html" id="loginLink" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg text-sm">
                    Login/Signup
                </a>
            </div>
            <button id="mobileMenuButton" class="md:hidden text-white">
                <span class="lucide" data-lucide="Menu"></span>
            </button>
        </div>
         <div id="mobileMenu" class="hidden md:hidden bg-gray-700 text-white py-2">
            <a href="#" class="block px-4 py-2 hover:bg-gray-600">Home</a>
            <a href="#" class="block px-4 py-2 hover:bg-gray-600">Resources</a>
            <a href="#" class="block px-4 py-2 hover:bg-gray-600">Services</a>
            <a href="#" class="block px-4 py-2 hover:bg-gray-600">Community</a>
            <a href="#" class="block px-4 py-2 hover:bg-gray-600">About</a>
            <a href="#" class="block px-4 py-2 hover:bg-gray-600">Contact</a>
            <div class="px-4 py-2">
                <input type="search" placeholder="Search..." class="bg-gray-600 text-white placeholder-gray-300 text-sm focus:outline-none w-full rounded-md p-1">
            </div>
        </div>
    </header>

    <section class="welcome-bg text-white py-4 shadow-inner">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-2xl font-bold">Welcome to SafetyHelp</h1>
            <p class="text-sm mt-1">Your trusted partner for OHS compliance and a safer tomorrow. Slogan: Safety Personalized, Compliance Simplified—Anytime, Anywhere.</p>
        </div>
    </section>

    <main class="flex-grow flex overflow-hidden">
        <aside class="w-1/5 bg-slate-100 p-3 overflow-y-auto no-scrollbar shadow-lg">
            <h2 class="text-lg font-semibold mb-3 text-gray-700 border-b pb-2">SafetyHelp Tools</h2>
            <ul class="space-y-2 text-sm">
                <li><a href="#" class="flex items-center text-gray-600 hover:text-blue-600 hover:bg-blue-100 p-2 rounded-md transition-colors"><span class="lucide mr-2 icon-placeholder" data-lucide="ShieldCheck"></span>Dashboard</a></li>
                <li><a href="#" class="flex items-center text-gray-600 hover:text-blue-600 hover:bg-blue-100 p-2 rounded-md transition-colors"><span class="lucide mr-2 icon-placeholder" data-lucide="ClipboardList"></span>Risk Assessments</a></li>
                <li><a href="#" class="flex items-center text-gray-600 hover:text-blue-600 hover:bg-blue-100 p-2 rounded-md transition-colors"><span class="lucide mr-2 icon-placeholder" data-lucide="AlertTriangle"></span>Incident Reporting</a></li>
                <li><a href="#" class="flex items-center text-gray-600 hover:text-blue-600 hover:bg-blue-100 p-2 rounded-md transition-colors"><span class="lucide mr-2 icon-placeholder" data-lucide="BookMarked"></span>Training Modules</a></li>
                <li><a href="#" class="flex items-center text-gray-600 hover:text-blue-600 hover:bg-blue-100 p-2 rounded-md transition-colors"><span class="lucide mr-2 icon-placeholder" data-lucide="FolderKanban"></span>Document Management</a></li>
                <li><a href="#" class="flex items-center text-gray-600 hover:text-blue-600 hover:bg-blue-100 p-2 rounded-md transition-colors"><span class="lucide mr-2 icon-placeholder" data-lucide="ListChecks"></span>Compliance Checklists</a></li>
                <li><a href="#" class="flex items-center text-gray-600 hover:text-blue-600 hover:bg-blue-100 p-2 rounded-md transition-colors"><span class="lucide mr-2 icon-placeholder" data-lucide="BarChart3"></span>Analytics & Reports</a></li>
            </ul>
        </aside>

        <section class="flex-grow w-3/5 bg-white p-3 overflow-y-auto no-scrollbar flex flex-col space-y-3">
            <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-3 rounded-md shadow">
                <p class="font-semibold flex items-center"><span class="text-2xl mr-2">⚡</span> Did you know?</p>
                <p class="text-sm" id="safetyTip">Using reputable ethical suppliers can reduce workplace hazards by ensuring work is done on time and to the highest quality and safety standards.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div class="bg-blue-50 p-3 rounded-lg shadow-md">
                    <h3 class="text-md font-semibold text-blue-700 mb-1">Next Module Countdown</h3>
                    <div id="countdownTimer" class="text-2xl font-bold text-blue-600">00d 00h 00m 00s</div>
                    <p class="text-xs text-gray-500 mt-1">New module launches at the start of each month!</p>
                </div>
                <div class="bg-green-50 p-3 rounded-lg shadow-md">
                    <h3 class="text-md font-semibold text-green-700 mb-1">SafetyHelp Brain of the Day</h3>
                    <p id="brainOfTheDay" class="text-xl font-bold text-green-600">Salatiso M. (150 pts)</p>
                    <p class="text-xs text-gray-500 mt-1">Top score in today's challenge!</p>
                </div>
            </div>

            <div class="bg-indigo-50 p-3 rounded-lg shadow-md">
                <h3 class="text-md font-semibold text-indigo-700 mb-2">Brain of SafetyHelp - Daily Challenge!</h3>
                <div id="quizArea">
                    </div>
                <button id="startQuizButton" class="mt-2 bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg text-sm transition-colors">
                    <span class="lucide icon-placeholder mr-1" data-lucide="Brain"></span> Start Daily Challenge
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div class="bg-purple-50 p-3 rounded-lg shadow-md">
                    <h3 class="text-md font-semibold text-purple-700 mb-1">Latest Podcast</h3>
                    <a href="#" class="text-purple-600 hover:text-purple-800 hover:underline flex items-center text-sm">
                        <span class="lucide icon-placeholder mr-2" data-lucide="Podcast"></span> Episode 5: Mastering Risk Communication
                    </a>
                </div>
                <div class="bg-teal-50 p-3 rounded-lg shadow-md">
                    <h3 class="text-md font-semibold text-teal-700 mb-1">Latest Article</h3>
                    <a href="#" class="text-teal-600 hover:text-teal-800 hover:underline flex items-center text-sm">
                        <span class="lucide icon-placeholder mr-2" data-lucide="FileText"></span> Top 10 OHS Trends for 2025
                    </a>
                </div>
            </div>

            <div class="bg-sky-50 p-3 rounded-lg shadow-md mt-3">
                <h3 class="text-md font-semibold text-sky-700 mb-1">🚀 SafetyHelp Has Launched!</h3>
                <p class="text-sm text-gray-700">Our core platform officially launched on <strong>June 1, 2025!</strong> We're excited to bring you a new era of OHS management.</p>
                <p class="text-sm text-gray-700 mt-1">Stay tuned for upcoming modules, including Advanced Construction Compliance and AI-Powered Risk Assessments, launching monthly (check the countdown!).</p>
                <p class="text-sm text-gray-700 mt-2">Be a pioneer! <a href="#" class="text-sky-600 hover:underline font-semibold">Join our Beta Program</a> to test new features, influence development, and get complimentary premium access. <a href="#" class="text-sky-600 hover:underline font-semibold">Register Now!</a></p>
            </div>
        </section>

        <aside class="w-1/5 bg-slate-100 p-3 overflow-y-auto no-scrollbar shadow-lg">
            <h2 class="text-lg font-semibold mb-3 text-gray-700 border-b pb-2">OHS Milestones</h2>
            <ul class="space-y-2 text-sm">
                <li class="text-gray-600"><span class="font-semibold text-gray-700">1970:</span> OSHA (USA)</li>
                <li class="text-gray-600"><span class="font-semibold text-gray-700">1993:</span> OHS Act (SA)</li>
                <li class="text-gray-600"><span class="font-semibold text-gray-700">2003:</span> COIDA Amendment</li>
                <li class="text-gray-600"><span class="font-semibold text-gray-700">2015:</span> Global Harmonization</li>
                <li class="text-gray-600"><span class="font-semibold text-gray-700">2022:</span> Mental Health Focus</li>
                <li class="text-gray-600"><span class="font-semibold text-gray-700">Future:</span> Predictive Safety</li>
            </ul>
        </aside>
    </main>

    <footer class="bg-gray-800 text-white py-3 text-center text-xs shadow-inner">
        <p>&copy; <span id="currentYear"></span> SafetyHelp. All Rights Reserved. | <a href="privacy.html" class="hover:underline">Privacy Policy</a> | <a href="terms.html" class="hover:underline">Terms of Service</a></p>
    </footer>

    <div id="chatbotContainer">
        <div id="chatbotWindow" class="hidden">
            <div id="chatHeader">
                <span>SafetyHelp Assistant</span>
                <button id="closeChat">&times;</button>
            </div>
            <div id="chatMessages" class="no-scrollbar">
                <div class="message bot-message">Hello! How can I assist you with OHS today?</div>
            </div>
            <div id="chatInputContainer">
                <input type="text" id="chatInput" placeholder="Type your question...">
                <button id="sendButton">
                    <span class="lucide" data-lucide="SendHorizonal" style="width:18px; height:18px;"></span>
                </button>
            </div>
        </div>
        <button id="chatbotToggle">
            <span class="lucide" data-lucide="MessageCircle" id="chatIconOpen"></span>
            <span class="lucide hidden" data-lucide="X" id="chatIconClose"></span>
        </button>
    </div>

    <div id="quizModalOverlay" class="quiz-modal-overlay hidden">
        <div class="quiz-modal-content no-scrollbar">
            <div id="quizModalQuestionArea">
                </div>
            <div id="quizModalRegistrationArea" class="hidden mt-4">
                <h3 class="text-lg font-semibold mb-2">Quiz Set Complete!</h3>
                <p class="mb-2">Register to save your score and compete on the leaderboard, or continue as a guest.</p>
                <input type="text" id="quizUserName" placeholder="Your Name (for leaderboard)" class="w-full p-2 border rounded mb-2">
                <input type="email" id="quizUserEmail" placeholder="Your Email (optional)" class="w-full p-2 border rounded mb-3">
                <div class="flex justify-between">
                    <button id="registerQuizUser" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded text-sm">Register & Continue</button>
                    <button id="continueQuizGuest" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded text-sm">Continue as Guest</button>
                </div>
                 <button id="closeQuizModal" class="mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 px-4 rounded text-sm w-full">Close Quiz</button>
            </div>
            <div id="quizModalResultsArea" class="hidden mt-4">
                </div>
        </div>
    </div>


    <script type="text/babel">
        const { useEffect, useState, useCallback } = React;

        function App() {
            // Mobile menu state
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

            // Countdown timer state
            const [timeLeft, setTimeLeft] = useState(calculateTimeLeft());

            // Chatbot state
            const [chatOpen, setChatOpen] = useState(false);
            const [messages, setMessages] = useState([{ sender: 'bot', text: 'Hello! How can I assist you with OHS today?' }]);
            const [inputValue, setInputValue] = useState('');

            // Quiz state
            const [quizActive, setQuizActive] = useState(false);
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [quizQuestions, setQuizQuestions] = useState([]);
            const [userAnswers, setUserAnswers] = useState([]);
            const [quizSetComplete, setQuizSetComplete] = useState(false);
            const [showQuizResults, setShowQuizResults] = useState(false);
            const [quizScore, setQuizScore] = useState(0);
            const [quizUserName, setQuizUserName] = useState('');
            const [quizUserEmail, setQuizUserEmail] = useState('');


            const allQuizQuestions = [
                {
                    question: "What does OHS stand for?",
                    options: ["Occupational Health and Safety", "Optimal Health Standards", "Operational Hazard Systems", "Office Health and Security"],
                    answer: "Occupational Health and Safety",
                    explanation: "OHS stands for Occupational Health and Safety, which is concerned with the safety, health, and welfare of people engaged in work or employment."
                },
                {
                    question: "Which color typically signifies 'danger' or 'stop' on safety signs?",
                    options: ["Red", "Yellow", "Green", "Blue"],
                    answer: "Red",
                    explanation: "Red is universally used on safety signs to indicate danger, prohibition (stop), or fire-fighting equipment."
                },
                {
                    question: "What is a 'Risk Assessment'?",
                    options: ["A fun team-building exercise", "A systematic process of evaluating potential risks", "A type of insurance policy", "A daily weather report"],
                    answer: "A systematic process of evaluating potential risks",
                    explanation: "A risk assessment is a careful examination of what, in your work, could cause harm to people, so that you can weigh up whether you have taken enough precautions or should do more."
                },
                {
                    question: "What is PPE?",
                    options: ["Personal Protective Equipment", "Public Protection Exercise", "Primary Prevention Effort", "Professional Performance Evaluation"],
                    answer: "Personal Protective Equipment",
                    explanation: "PPE refers to Personal Protective Equipment, such as helmets, gloves, eye protection, respirators, and safety footwear, designed to protect the wearer from injury or infection."
                },
                {
                    question: "An 'incident' in OHS terms typically refers to:",
                    options: ["A planned safety drill", "An unplanned event that could have led to, or did result in, harm", "A company picnic", "A scheduled maintenance check"],
                    answer: "An unplanned event that could have led to, or did result in, harm",
                    explanation: "An incident is an unplanned, undesired event that hinders completion of a task and may cause injury or other damage. This includes near misses."
                },
                // Add more questions for subsequent sets
                 {
                    question: "What is the primary goal of an Emergency Evacuation Plan?",
                    options: ["To test the fire alarm system", "To ensure everyone gets a day off", "To safely and quickly move people from a dangerous area", "To count office supplies"],
                    answer: "To safely and quickly move people from a dangerous area",
                    explanation: "The primary goal of an Emergency Evacuation Plan is to ensure the safe and orderly evacuation of all personnel from a hazardous area to a designated safe location."
                },
                {
                    question: "Which of these is a common workplace ergonomic hazard?",
                    options: ["Loud music", "Poorly designed workstation", "Spilled coffee", "Bright sunlight"],
                    answer: "Poorly designed workstation",
                    explanation: "A poorly designed workstation can lead to musculoskeletal disorders (MSDs) due to awkward postures, repetitive motions, or excessive force, making it an ergonomic hazard."
                },
                {
                    question: "What does 'COIDA' stand for in South African OHS?",
                    options: ["Council of Industrial Development and Advancement", "Compensation for Occupational Injuries and Diseases Act", "Committee for Operational Incident Data Analysis", "Construction Oversight and Inspection Department Agency"],
                    answer: "Compensation for Occupational Injuries and Diseases Act",
                    explanation: "COIDA stands for the Compensation for Occupational Injuries and Diseases Act, which provides for compensation for disablement caused by occupational injuries or diseases sustained or contracted by employees in the course of their employment, or for death resulting from such injuries or diseases."
                },
                {
                    question: "A 'Safety Data Sheet (SDS)' provides information about:",
                    options: ["Company financial performance", "Employee work schedules", "Hazardous chemicals", "Office cleaning procedures"],
                    answer: "Hazardous chemicals",
                    explanation: "A Safety Data Sheet (SDS), formerly known as MSDS, provides comprehensive information about a hazardous chemical, including its properties, hazards, safe handling, and emergency control measures."
                },
                {
                    question: "What is the 'Hierarchy of Controls' in risk management?",
                    options: ["A list of company managers", "A ranking of control measures from most to least effective", "A schedule for safety meetings", "A system for organizing safety documents"],
                    answer: "A ranking of control measures from most to least effective",
                    explanation: "The Hierarchy of Controls is a system used in workplace safety to minimize or eliminate exposure to hazards. It ranks controls from most effective to least effective: Elimination, Substitution, Engineering Controls, Administrative Controls, and PPE."
                }
            ];

            const loadQuizSet = () => {
                const setSize = 5;
                const start = (Math.floor(currentQuestionIndex / setSize)) * setSize;
                const end = Math.min(start + setSize, allQuizQuestions.length);
                const newSet = allQuizQuestions.slice(start, end);
                if (newSet.length > 0) {
                    setQuizQuestions(newSet);
                    setUserAnswers(new Array(newSet.length).fill(null));
                    setCurrentQuestionIndex(start); // Reset to the start of the new set for internal tracking
                    setShowQuizResults(false);
                    setQuizSetComplete(false);
                } else {
                    // No more questions
                    setQuizActive(false);
                    alert("You've completed all available questions!");
                }
            };
            
            const startQuiz = () => {
                setCurrentQuestionIndex(0); // Start from the very beginning of all questions
                setQuizScore(0);
                loadQuizSet();
                setQuizActive(true);
                setQuizSetComplete(false);
                setShowQuizResults(false);
            };


            const handleAnswer = (optionIndex) => {
                const currentSetQuestionIndex = currentQuestionIndex % 5; // Index within the current set of 5
                const newAnswers = [...userAnswers];
                newAnswers[currentSetQuestionIndex] = quizQuestions[currentSetQuestionIndex].options[optionIndex];
                setUserAnswers(newAnswers);

                if (newAnswers[currentSetQuestionIndex] === quizQuestions[currentSetQuestionIndex].answer) {
                    setQuizScore(prevScore => prevScore + 10); // Add 10 points for correct answer
                }

                // Move to next question or end set
                if (currentSetQuestionIndex < quizQuestions.length - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                } else {
                    setQuizSetComplete(true); // Mark set as complete to show registration/results
                }
            };
            
            const handleRegisterAndContinue = async () => {
                const name = document.getElementById('quizUserName').value.trim();
                const email = document.getElementById('quizUserEmail').value.trim();

                if (name) {
                     setQuizUserName(name); // Store for potential display
                    // Save to Firestore
                    if (window.firebaseDB && window.currentUserId && window.appId) {
                        try {
                            const userScoreRef = doc(window.firebaseDB, `artifacts/${window.appId}/public/data/quizLeaderboard`, window.currentUserId);
                            await setDoc(userScoreRef, {
                                name: name,
                                email: email, // Optional
                                score: quizScore, // Save current total score
                                lastPlayed: new Date()
                            }, { merge: true });
                            console.log("User score saved for:", name);
                            // Potentially update Brain of the Day display
                            updateBrainOfTheDay();
                        } catch (error) {
                            console.error("Error saving user score: ", error);
                        }
                    }
                }
                // Proceed to show results, then offer next set or close
                setShowQuizResults(true);
                setQuizSetComplete(false); // Allow next set
            };

            const handleContinueGuest = () => {
                // Proceed to show results, then offer next set or close
                setShowQuizResults(true);
                setQuizSetComplete(false); // Allow next set
            };

            const handleCloseQuiz = () => {
                setQuizActive(false);
                setQuizSetComplete(false);
                setShowQuizResults(false);
                setCurrentQuestionIndex(0);
                setQuizScore(0);
            };
            
            const handleNextQuizSet = () => {
                // Determine if there are more questions
                const nextQuestionGlobalIndex = (Math.floor(currentQuestionIndex / 5) + 1) * 5;
                if (nextQuestionGlobalIndex < allQuizQuestions.length) {
                    setCurrentQuestionIndex(nextQuestionGlobalIndex); // Set to the start of the next set
                    loadQuizSet(); // This will load the next set of questions
                    setShowQuizResults(false);
                    setQuizSetComplete(false);
                } else {
                    alert("You've completed all available questions!");
                    handleCloseQuiz();
                }
            };


            // Mobile menu toggle
            const toggleMobileMenu = () => setMobileMenuOpen(!mobileMenuOpen);
            useEffect(() => {
                const menu = document.getElementById('mobileMenu');
                if (mobileMenuOpen) {
                    menu.classList.remove('hidden');
                } else {
                    menu.classList.add('hidden');
                }
            }, [mobileMenuOpen]);


            // Countdown timer logic
            function calculateTimeLeft() {
                const now = new Date();
                const year = now.getFullYear();
                const month = now.getMonth();
                // End of the current month
                const endOfMonth = new Date(year, month + 1, 0, 23, 59, 59, 999);

                const difference = +endOfMonth - +now;
                let timeLeftData = {};

                if (difference > 0) {
                    timeLeftData = {
                        days: Math.floor(difference / (1000 * 60 * 60 * 24)),
                        hours: Math.floor((difference / (1000 * 60 * 60)) % 24),
                        minutes: Math.floor((difference / 1000 / 60) % 60),
                        seconds: Math.floor((difference / 1000) % 60),
                    };
                } else { // Timer ended for this month
                     timeLeftData = { days: 0, hours: 0, minutes: 0, seconds: 0 };
                }
                return timeLeftData;
            }

            useEffect(() => {
                const timer = setTimeout(() => {
                    setTimeLeft(calculateTimeLeft());
                }, 1000);
                return () => clearTimeout(timer);
            });

            const formatTime = (value) => String(value).padStart(2, '0');


            // Chatbot logic
            const toggleChat = () => {
                setChatOpen(!chatOpen);
                document.getElementById('chatIconOpen').classList.toggle('hidden', !chatOpen);
                document.getElementById('chatIconClose').classList.toggle('hidden', chatOpen);
            };
            
            const handleSendMessage = async () => {
                if (inputValue.trim() === '') return;
                const newMessages = [...messages, { sender: 'user', text: inputValue }];
                setMessages(newMessages);
                const currentInput = inputValue;
                setInputValue('');

                // Simple bot response (can be expanded with Gemini API later)
                let botResponse = "I'm processing your request...";
                 if (window.firebaseDB && window.appId) {
                    // Placeholder for Gemini API call or Firestore query
                    // For now, a simple echo or canned response
                    if (currentInput.toLowerCase().includes("safety tip")) {
                        botResponse = "Always wear appropriate PPE for your task!";
                    } else if (currentInput.toLowerCase().includes("risk assessment")) {
                        botResponse = "Risk assessment involves identifying hazards, analyzing risks, and implementing controls.";
                    } else {
                        botResponse = `I received your message: "${currentInput}". I am still learning!`;
                    }
                } else {
                    botResponse = "Sorry, my connection to the knowledge base is unavailable right now.";
                }


                // Simulate API call delay
                setTimeout(() => {
                    setMessages(prevMessages => [...prevMessages, { sender: 'bot', text: botResponse }]);
                    const chatMessagesDiv = document.getElementById('chatMessages');
                    if (chatMessagesDiv) chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight;
                }, 1000);
            };
            
            useEffect(() => {
                const chatMessagesDiv = document.getElementById('chatMessages');
                if (chatMessagesDiv) chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight;
            }, [messages]);

            // Update Brain of the Day from Firestore
            const updateBrainOfTheDay = async () => {
                if (window.firebaseDB && window.appId) {
                    try {
                        const q = query(collection(window.firebaseDB, `artifacts/${window.appId}/public/data/quizLeaderboard`), orderBy("score", "desc"), limit(1));
                        const querySnapshot = await getDocs(q);
                        if (!querySnapshot.empty) {
                            const topScorer = querySnapshot.docs[0].data();
                            document.getElementById('brainOfTheDay').textContent = `${topScorer.name} (${topScorer.score} pts)`;
                        } else {
                             document.getElementById('brainOfTheDay').textContent = `Be the first!`;
                        }
                    } catch (error) {
                        console.error("Error fetching leaderboard: ", error);
                        document.getElementById('brainOfTheDay').textContent = `Leaderboard unavailable`;
                    }
                }
            };

            useEffect(() => {
                updateBrainOfTheDay(); // Initial load
                // Optionally, set up a listener for real-time updates if desired
            }, []);


            // Dynamic year in footer
            useEffect(() => {
                document.getElementById('currentYear').textContent = new Date().getFullYear();
            }, []);
            
            // Lucide icons replacement
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [chatOpen, mobileMenuOpen, quizActive]); // Re-run if chat/menu opens to catch new icons

            // Click listener for logo
            useEffect(() => {
                const logo = document.getElementById('logoLink');
                const handleLogoClick = () => {
                    // For a single page app, this might reset view or scroll to top
                    // For multi-page, it would be window.location.href = 'index.html';
                    console.log("Logo clicked, returning to homepage/top.");
                    if (window.scrollTo) window.scrollTo({ top: 0, behavior: 'smooth' });
                };
                logo.addEventListener('click', handleLogoClick);
                return () => logo.removeEventListener('click', handleLogoClick);
            }, []);


            return (
                <>
                    {/* Mobile Menu Button in Header */}
                    {/* Chatbot Toggle and Window in Body */}
                    {/* Quiz Modal in Body */}
                </>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));

        // Separate script for non-React dependent JS for simplicity here
        document.addEventListener('DOMContentLoaded', () => {
            // Mobile menu
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }

            // Chatbot
            const chatbotToggle = document.getElementById('chatbotToggle');
            const chatbotWindow = document.getElementById('chatbotWindow');
            const closeChat = document.getElementById('closeChat');
            const sendButton = document.getElementById('sendButton');
            const chatInput = document.getElementById('chatInput');
            const chatIconOpen = document.getElementById('chatIconOpen');
            const chatIconClose = document.getElementById('chatIconClose');

            if (chatbotToggle) {
                chatbotToggle.addEventListener('click', () => {
                    chatbotWindow.classList.toggle('hidden');
                    chatIconOpen.classList.toggle('hidden');
                    chatIconClose.classList.toggle('hidden');
                });
            }
            if (closeChat) {
                closeChat.addEventListener('click', () => {
                    chatbotWindow.classList.add('hidden');
                    chatIconOpen.classList.remove('hidden');
                    chatIconClose.classList.add('hidden');
                });
            }
            // Send message functionality would be handled by React state,
            // but if you need a non-React way:
            if (sendButton && chatInput) {
                 sendButton.addEventListener('click', () => {
                    // This is a placeholder, React handles the actual send
                    console.log("Send button clicked (non-React):", chatInput.value);
                });
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        // Placeholder
                         console.log("Enter pressed (non-React):", chatInput.value);
                    }
                });
            }


            // Countdown Timer Display (React handles logic)
            const countdownDiv = document.getElementById('countdownTimer');
            // React will update this, but for initial non-JS view or as fallback:
            if (countdownDiv && !countdownDiv.textContent.includes('d')) { // Check if React hasn't populated it
                 countdownDiv.textContent = "Loading timer...";
            }
            
            // Lucide icons (React handles this via useEffect, but ensure it runs)
            if (window.lucide) {
                window.lucide.createIcons();
            }

            // Quiz Modal elements (React handles logic)
            const startQuizButton = document.getElementById('startQuizButton');
            const quizModalOverlay = document.getElementById('quizModalOverlay');
            const closeQuizModalButton = document.getElementById('closeQuizModal'); // In registration area
            
            if(startQuizButton) {
                // React's startQuiz function will be called via its own event handler
            }

            if(quizModalOverlay && closeQuizModalButton) {
                 // React's handleCloseQuiz will be called
            }
        });

    </script>
    <div id="root"></div> </body>
</html>
